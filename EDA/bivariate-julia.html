<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Julia for Introductory Statistics - 4&nbsp; Bivariate data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../EDA/categorical-data-julia.html" rel="next">
<link href="../EDA/tabular-data-julia.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bivariate data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Using Julia for Introductory Statistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jverzani/UsingJ" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/univariate-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Univariate data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/tabular-data-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tabular data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/bivariate-julia.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bivariate data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/categorical-data-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/makie.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The <code>AlgebraOfGraphics</code> package</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/distributions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability distributions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/inference.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LinearModels/linear-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The linear regression model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#multiple-samples" id="toc-multiple-samples" class="nav-link active" data-scroll-target="#multiple-samples"><span class="toc-section-number">4.1</span>  Multiple samples</a>
  <ul class="collapse">
  <li><a href="#grouped-dot-plots" id="toc-grouped-dot-plots" class="nav-link" data-scroll-target="#grouped-dot-plots"><span class="toc-section-number">4.1.1</span>  Grouped dot plots</a></li>
  <li><a href="#boxplots-across-groups" id="toc-boxplots-across-groups" class="nav-link" data-scroll-target="#boxplots-across-groups"><span class="toc-section-number">4.1.2</span>  Boxplots across groups</a></li>
  <li><a href="#violin-and-density-plots" id="toc-violin-and-density-plots" class="nav-link" data-scroll-target="#violin-and-density-plots"><span class="toc-section-number">4.1.3</span>  Violin and density plots</a></li>
  <li><a href="#quantile-comparisons" id="toc-quantile-comparisons" class="nav-link" data-scroll-target="#quantile-comparisons"><span class="toc-section-number">4.1.4</span>  Quantile comparisons</a></li>
  </ul></li>
  <li><a href="#paired-data" id="toc-paired-data" class="nav-link" data-scroll-target="#paired-data"><span class="toc-section-number">4.2</span>  Paired data</a>
  <ul class="collapse">
  <li><a href="#numeric-summaries" id="toc-numeric-summaries" class="nav-link" data-scroll-target="#numeric-summaries"><span class="toc-section-number">4.2.1</span>  Numeric summaries</a></li>
  <li><a href="#trend-lines" id="toc-trend-lines" class="nav-link" data-scroll-target="#trend-lines"><span class="toc-section-number">4.2.2</span>  Trend lines</a></li>
  <li><a href="#local-regression" id="toc-local-regression" class="nav-link" data-scroll-target="#local-regression"><span class="toc-section-number">4.2.3</span>  Local regression</a></li>
  <li><a href="#robust-linear-models" id="toc-robust-linear-models" class="nav-link" data-scroll-target="#robust-linear-models"><span class="toc-section-number">4.2.4</span>  Robust linear models</a></li>
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="toc-section-number">4.2.5</span>  Prediction</a></li>
  <li><a href="#assessing-the-residuals" id="toc-assessing-the-residuals" class="nav-link" data-scroll-target="#assessing-the-residuals"><span class="toc-section-number">4.2.6</span>  Assessing the residuals</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations"><span class="toc-section-number">4.2.7</span>  Transformations</a></li>
  <li><a href="#grouping-by-a-categorical-variable" id="toc-grouping-by-a-categorical-variable" class="nav-link" data-scroll-target="#grouping-by-a-categorical-variable"><span class="toc-section-number">4.2.8</span>  Grouping by a categorical variable</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jverzani/UsingJ/edit/master/EDA/bivariate-julia.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jverzani/UsingJ/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bivariate data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>We now consider two variables measured for the same observation, or bivariate data. The combinations of numeric data or categorical data lead to different means to describe and visualize the sets of data.</p>
<p>We load our basic suite of packages:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span>, <span class="bu">StatsPlots</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">CategoricalArrays</span>, <span class="bu">Chain</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RDatasets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following, we use the widely used <code>iris</code> data set which has numeric measurements of sepal and petal width and lengths for 3 species of irises.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>iris <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"iris"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(iris, <span class="fl">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div><div style="float: left;"><span>3×5 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">SepalLength</th><th style="text-align: left;">SepalWidth</th><th style="text-align: left;">PetalLength</th><th style="text-align: left;">PetalWidth</th><th style="text-align: left;">Species</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="Float64" style="text-align: left;">Float64</th><th title="Float64" style="text-align: left;">Float64</th><th title="Float64" style="text-align: left;">Float64</th><th title="Float64" style="text-align: left;">Float64</th><th title="CategoricalValue{String, UInt8}" style="text-align: left;">Cat…</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: right;">5.1</td><td style="text-align: right;">3.5</td><td style="text-align: right;">1.4</td><td style="text-align: right;">0.2</td><td style="text-align: left;">setosa</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">2</td><td style="text-align: right;">4.9</td><td style="text-align: right;">3.0</td><td style="text-align: right;">1.4</td><td style="text-align: right;">0.2</td><td style="text-align: left;">setosa</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">3</td><td style="text-align: right;">4.7</td><td style="text-align: right;">3.2</td><td style="text-align: right;">1.3</td><td style="text-align: right;">0.2</td><td style="text-align: left;">setosa</td></tr></tbody></table></div>
</div>
</div>
<p>There are 50 cases per species:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">combine</span>(<span class="fu">groupby</span>(iris, <span class="op">:</span>Species), nrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div><div style="float: left;"><span>3×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">Species</th><th style="text-align: left;">nrow</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="CategoricalValue{String, UInt8}" style="text-align: left;">Cat…</th><th title="Int64" style="text-align: left;">Int64</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: left;">setosa</td><td style="text-align: right;">50</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">2</td><td style="text-align: left;">versicolor</td><td style="text-align: right;">50</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">3</td><td style="text-align: left;">virginica</td><td style="text-align: right;">50</td></tr></tbody></table></div>
</div>
</div>
<section id="multiple-samples" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="multiple-samples"><span class="header-section-number">4.1</span> Multiple samples</h2>
<p>A common scenario is when data for a measurement is collected across multiple levels of a factor to see if there is something about that factor that has an effect on the measurement. As measurements typically have fluctuations, this “effect” must be understood relative to some understanding of the underlying variability. To gather that, a probability model might be used. For now, we content ourselves with common graphical comparisons, which can be used to distinguish large effects.</p>
<p>First we graphically explore one measurement, <code>PetalWidth</code>, for the 3 different species. A typical question might be, is the average petal width the same across the three species?</p>
<p>The data storage in <code>iris</code> is tidy data, each row is an observation, the <code>PetalWidth</code> is the variable. Were the data in a long format with a variable for each level of the factor, the <code>stack</code> command would prove useful to tidy the data.</p>
<p>The graphics are created by splitting the data along the levels of the factor and then applying the graphic to the univariate data for each group. For this task, the <code>StatsPlots</code> package is useful.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="grouped-dot-plots" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="grouped-dot-plots"><span class="header-section-number">4.1.1</span> Grouped dot plots</h3>
<p>A dot plot is a useful graphic to show the distribution of values on a number line when the data is sufficiently spread out so as not to overlap too much. The basic graphic is <span class="math inline">\(1\)</span>-dimensional, adding a second dimension for the grouping variable allows easy comparisons.</p>
<p>Here we discuss dot plots for different levels of a factor. In the <code>iris</code> data set, to create plots by each species (<a href="#fig-grouped-dotplot">Figure&nbsp;<span>4.1</span></a>), allowing a comparison of the distribution of the <span class="math inline">\(x\)</span> variable over different levels of a factor. The following illustrates the steps done, but we will see next that such effort is unneeded as the <code>StatsPlots</code> recipes wrap up this data manipulation, in this case with a method for <code>dotplot</code>.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>byspecies <span class="op">=</span> <span class="fu">groupby</span>(iris, <span class="op">:</span>Species)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> StatsPlots.<span class="fu">plot</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i, k) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">keys</span>(byspecies)) <span class="co"># iterate over keys</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    species <span class="op">=</span> k.Species</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> byspecies[k].PetalWidth</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> i <span class="op">.+</span> <span class="fu">one</span>.(xs)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dotplot!</span>(p1, xs, ys; label<span class="op">=</span>species)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>p1;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The identification of the species after grouping is a bit awkward, but the idea is we split the data, then create a dot plot for each level of the grouping variable, <code>:Species</code>.</p>
<p>This is more easily done by passing <code>:Species</code> as the <span class="math inline">\(y\)</span> value to <code>dotplot</code>, in which case the categorical variable is used for grouping.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="pp">@df</span> iris <span class="fu">dotplot</span>(<span class="op">:</span>PetalWidth, <span class="op">:</span>Species; legend<span class="op">=</span><span class="cn">false</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>@df</code> macro was used as a convenience. This replaces the symbols in the expression with the corresponding column in the specified data frame.</p>
<div class="cell" data-execution_count="7">
<div class="cell-output cell-output-display" data-execution_count="8">
<div id="fig-grouped-dotplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-grouped-dotplot-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: Grouped dot plots allow an easy comparison of the distribution of a variable over the levels of a categorical variable. These two use the same data set, but were produced different ways. The left-most was done “by hand” and uses a legend to distinguish the species. The right-most was produced by <code>dotplot</code> with labels used to mark the species.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Putting the categorical variable first, presents a graphic (<a href="#fig-grouped-dotplot-jitter">Figure&nbsp;<span>4.2</span></a>) which uses jittering to disambiguate equal measurements in a species:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> iris <span class="fu">dotplot</span>(<span class="op">:</span>Species, <span class="op">:</span>PetalWidth; legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div id="fig-grouped-dotplot-jitter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-grouped-dotplot-jitter-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: the categorial variable’s position determines the layout chosen for the grouped dot plot. In this figure, the categorical variable was in the <code>x</code> position, and the numeric data was jittered left and right.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Regardless of how the graphic is produced, there appears to be a difference in the centers based on the species, as would be expected – different species have different sizes.</p>
</section>
<section id="boxplots-across-groups" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="boxplots-across-groups"><span class="header-section-number">4.1.2</span> Boxplots across groups</h3>
<p>Grouped boxplots are made in a similar manner to the last example using <code>boxplot</code> (<a href="#fig-boxplots">Figure&nbsp;<span>4.3</span></a>); we use the categorical variable indicating grouping in the <code>x</code> position:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> iris <span class="fu">boxplot</span>(<span class="op">:</span>Species, <span class="op">:</span>PetalWidth; legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div id="fig-boxplots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-boxplots-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: a basic boxplot comparing petal width across the different species.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Ode to the boxplots
</div>
</div>
<div class="callout-body-container callout-body">
<p>The box plot is a great graphic for comparing values across the levels of some factor. Each boxplot shows the center (the median), the range (the IQR), the shape (well basic symmetry about the median), the outlying values (with its identying rule of 1.5 IQRs beyond <span class="math inline">\(Q_1\)</span> and <span class="math inline">\(Q_3\)</span>. The only drawback is boxplots can’t show multi modal data. But if the factor is the cause of that, then the collection of boxplots is great for comparison.</p>
</div>
</div>
</section>
<section id="violin-and-density-plots" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="violin-and-density-plots"><span class="header-section-number">4.1.3</span> Violin and density plots</h3>
<p>A violin plot is like the boxplot, only it is wider where more data is concentrated, and smaller where less is. It uses a sideways density plot to summarize the data, whereas a boxplot only uses the five-number summary. The <code>violin</code> function creates these (<a href="#fig-boxplot-violinplot">Figure&nbsp;<span>4.4</span></a>):</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="pp">@df</span> iris <span class="fu">violin</span>(<span class="op">:</span>Species, <span class="op">:</span>PetalWidth; legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@df</span> iris <span class="fu">dotplot!</span>(p2, <span class="op">:</span>Species, <span class="op">:</span>PetalWidth; legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div id="fig-boxplot-violinplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-boxplot-violinplot-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: Illustration of a violin plot with a dotplot overlay for the petal width across the different species.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As illustrated for univariate data, the <code>density</code> function makes a density plot. There is an option for grouped data.</p>
<p>As seen below, the grouping variable is a named, not positional argument. In <a href="#fig-density-grouped-density">Figure&nbsp;<span>4.5</span></a> the left plot is done without grouping, the right one with grouping by species. The left plot shows a <em>multi-modal</em> distribution, which suggests, as we already have seen, that there is a mixture of populations in the data. There appear to be two modes, with a hint of a third. The separation between the “setosa” species and the other two is greater than the separation between the two others.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="pp">@df</span> iris <span class="fu">density</span>(<span class="op">:</span>PetalWidth; legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="pp">@df</span> iris <span class="fu">density</span>(<span class="op">:</span>PetalWidth, group<span class="op">=:</span>Species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="cell-output cell-output-display" data-execution_count="13">
<div id="fig-density-grouped-density" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-density-grouped-density-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.5: Density plots of <code>PetalWidth</code> and <code>PetalWidth</code> by <code>Species</code>. The left graphic suggests multiple modes, which are revealed in the right graphic.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="quantile-comparisons" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="quantile-comparisons"><span class="header-section-number">4.1.4</span> Quantile comparisons</h3>
<p>A “quantile-quantile plot” plots pairs of quantiles from two data sets as a scatter plot to help gauge if the shape of the two distributions is similar. If it is, the data will fall roughly on a straight line. The previously discussed quantile-normal plot is identical, with the specialization that one of the distributions is the reference normal distribution.</p>
<p>We use this plot to check if the <em>shape</em> of the distribution for two different species is roughly the same. To do so, we extract the <code>PetalWidth</code> values for the different levels of <code>:Species</code>. A direct way might be indexing: <code>iris[iris.Species .== "versicolor", :PetalWidth]</code> or with <code>subset</code>: <code>subset(iris, :Species =&gt; ByRow(==("versicolor"))).PetalWidth</code>. In the following we group by <code>:Species</code> then for each group apply a <span class="math inline">\(z\)</span>-score to <code>:PetalWidth</code>. From here, we can compare the 1st and 2nd and then the 2nd and 3rd group with <code>qqplot</code> in <a href="#fig-qqplot-petalwidth">Figure&nbsp;<span>4.6</span></a>. There is not a strong reason to expect big differences in shape.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jitter</span>(x, scale <span class="op">=</span> <span class="fl">0.25</span>) <span class="op">=</span> x <span class="op">+</span> scale <span class="op">*</span> <span class="fu">randn</span>(<span class="fu">length</span>(x))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gps <span class="op">=</span> [<span class="fu">select</span>(gp, <span class="op">:</span>PetalWidth <span class="op">=&gt;</span> zscore<span class="op">∘</span>jitter <span class="op">=&gt;</span> <span class="op">:</span>PetalWidth)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>       for gp <span class="kw">in</span> <span class="fu">groupby</span>(iris, <span class="op">:</span>Species)]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="fu">qqplot</span>(gps[<span class="fl">1</span>].PetalWidth, gps[<span class="fl">2</span>].PetalWidth)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="fu">qqplot</span>(gps[<span class="fl">2</span>].PetalWidth, gps[<span class="fl">3</span>].PetalWidth);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="cell-output cell-output-display" data-execution_count="15">
<div id="fig-qqplot-petalwidth" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-qqplot-petalwidth-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.6: A <code>qqplot</code> of the petal width from the versicolor and virginica species. The graphic suggests similar-shaped distributions. The data is jittered to disambiguate identical values.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="paired-data" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="paired-data"><span class="header-section-number">4.2</span> Paired data</h2>
<p>We have looked at a single variable over several levels of a given factor. If the data is split along the factor, there are possibly a different number of measurements for the given level. A key statistical assumption for inference will be that these different measurements are <em>independent</em>.</p>
<p>We might express this data as</p>
<p><span class="math display">\[\begin{align*}
x_{11}, &amp; x_{12}, \dots, x_{1n_1}\\
x_{21}, &amp; x_{22}, \dots, x_{2n_2}\\
    &amp; \vdots \\
x_{m1}, &amp; x_{m2}, \dots, x_{mn_m}.
\end{align*}\]</span></p>
<p>Now we turn our attention to data of two measured variables for a given observation. These two variables must have the same number of values, this being equal to the number of observations. Moreover, it need not be the case that the two measurements should be “independent,” indeed, the measurements are from the same case, so, for example with the iris data, if a plant has a large petal width it will likely also have a large petal length.</p>
<p>We might express the data mathematically as:</p>
<p><span class="math display">\[\begin{align*}
x_{1}, &amp; x_{2}, \dots, x_{n}\\
y_{1}, &amp; y_{2}, \dots, y_{n}
\end{align*}\]</span></p>
<p>Or – to emphasize how the data is paired off – as <span class="math inline">\((x_1, y_1), (x_2, y_2), \dots, (x_n, y_n)\)</span>.</p>
<section id="numeric-summaries" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="numeric-summaries"><span class="header-section-number">4.2.1</span> Numeric summaries</h3>
<p>The main numeric summary of paired data is the Pearson correlation coefficient. In terms of <span class="math inline">\(z\)</span> scores this is almost the average of their respective products:</p>
<p><span class="math display">\[
cor = \frac{1}{n-1} \sum \left(\frac{x_i - \bar{x}}{s_x}\right) \cdot \left(\frac{y_i - \bar{y}}{s_y}\right).
\]</span></p>
<p>The <code>cor</code> function computes this measure.</p>
<p>Consider again the <code>iris</code> data, only we select below just the <code>setosa</code> data and the petal attributes:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>l, w <span class="op">=</span> <span class="pp">@chain</span> iris <span class="cf">begin</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="op">:</span>Species <span class="op">=&gt;</span> <span class="fu">ByRow</span>(<span class="op">==</span>(<span class="st">"setosa"</span>)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>([<span class="op">:</span>PetalLength, <span class="op">:</span>PetalWidth])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    eachcol</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have the correlation computed by</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(l, w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.3316300408041188</code></pre>
</div>
</div>
<p>The correlation will be seen to be measure of linear associativity. When it is close to 1 or -1, the variability in the data is well described by a line; when close to 0, not so.</p>
<p>The correlation can be computed from a matrix for each pair of columns. This is done here for illustration:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@chain</span> iris <span class="cf">begin</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="op">:</span>Species <span class="op">=&gt;</span> <span class="fu">ByRow</span>(<span class="op">==</span>(<span class="st">"setosa"</span>)))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(_, <span class="fu">names</span>(_, <span class="dt">Real</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Matrix</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    cor</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>4×4 Matrix{Float64}:
 1.0       0.742547  0.267176  0.278098
 0.742547  1.0       0.1777    0.232752
 0.267176  0.1777    1.0       0.33163
 0.278098  0.232752  0.33163   1.0</code></pre>
</div>
</div>
<p>The Spearman correlation is the correlation of the data <em>after</em> ranking. It is a measure of monotonicity in the data. There are different ranking algorithms in <code>StatsBase</code>, the Spearman correlation uses <code>tiedrank</code>. It can be computed with this or with <code>corspearman</code>, as shown:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corspearman</span>(l, w), <span class="fu">cor</span>(<span class="fu">tiedrank</span>(l), <span class="fu">tiedrank</span>(w))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(0.2711413763783511, 0.2711413763783511)</code></pre>
</div>
</div>
<p>The primary graphic to assess the relationship between the two, presumably, dependent variables is a scatter plot:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(l, w; legend<span class="op">=</span><span class="cn">false</span>, xlab<span class="op">=</span><span class="st">"PetalLength"</span>, ylab<span class="op">=</span><span class="st">"PetalWidth"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fu">mean</span>(l)], linestyle<span class="op">=:</span>dash)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hline!</span>([<span class="fu">mean</span>(w)], linestyle<span class="op">=:</span>dash)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div id="fig-scatterplot-l-w" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-scatterplot-l-w-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.7: Scatter plot of petal length and petal width for the <em>setosa</em> data. The dashed lines show the “center” of the data, <span class="math inline">\((\bar{x}, \bar{y})\)</span>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-scatterplot-l-w">Figure&nbsp;<span>4.7</span></a> shows the length and width data in a scatter plot. Jittering would be helpful to show all the data, as it has been discretized and many points are overplotte. The dashed lines are centered at the means of the respective variables. If the mean is the center of a single variable, then <span class="math inline">\((\bar{x}, \bar{y})\)</span> may be thought of as the center of the paired data. Thinking of the dashed lines meeting at the origin, four quadrants are formed. The correlation can be viewed as a measure of how much the data sits in opposite quadrants. In the figure, there seems to be more data in quadrants I and III then II and IV, which sugests a <em>positive</em> correlation, as confirmed numerically.</p>
<p>By writing the correlation in terms of <span class="math inline">\(z\)</span>-scores, the product in that formula is <em>positive</em> if the point is in quadrant I or III and negative if in II or IV. So, for example, a big positive number suggests data is concentrated in quadrants I and III or that there is a strong association between the variables. The scaling by the standard deviations, leaves the mathematical constraint that the correlation is between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Correlation is not causation
</div>
</div>
<div class="callout-body-container callout-body">
<p>The expression “correlation is not causation” is a common one, due to efforts by the tobacco industry to give plausible alternatives to the statistical association of cigarette smoking and health problems such as lung cancer. Indeed, in some instances correlation between two variables can be related to a lurking or confounding variable. An example might be coffee consumption is positively associated with heart disease, yet is not necessarily the cause, as smoking is associated with both variables and may be the cause.</p>
</div>
</div>
</section>
<section id="trend-lines" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="trend-lines"><span class="header-section-number">4.2.2</span> Trend lines</h3>
<p>We mentioned that the Pearson correlation is a measure of a linear association and the Spearman rank correlation a measure of monotonic association. We now discuss some basic <em>trend lines</em> that highlight the association in paired data, where there is response variable.</p>
<p>We use the language <em>explanatory</em> variable to describe the <span class="math inline">\(x\)</span> variable, and <em>response</em> variable to describe the <span class="math inline">\(y\)</span> variable, with the understanding that <span class="math inline">\(x\)</span> might be experimentally controlled and <span class="math inline">\(y\)</span> a random measured response. The “line” is an explanation of how the <span class="math inline">\(y\)</span> values vary <em>on average</em> as the <span class="math inline">\(x\)</span> values vary by the experimenter.</p>
<p>There are many choices for how to identify a trend line, though we will show one such way that is the most commonly used. To set it in a mathematical setting, a line can be parameterized by two values, <span class="math inline">\(y = \beta_0 + \beta_1 x\)</span>. Use the value <span class="math inline">\(\hat{y}_i = \beta_0 + \beta_1 x_i\)</span>, which is the <span class="math inline">\(y\)</span> value of the point on the line corresponding to <span class="math inline">\(x_i\)</span>. The residual amount is usually defined by <span class="math inline">\(e_i = y_i - \hat{y}_i\)</span>. That is the vertical distance from the data point to the line. See <a href="#fig-two-models">Figure&nbsp;<span>4.8</span></a> for a visualization. One could argue that the distance to the line might be better than the vertical distance, but this choice leads to a very useful mathematical characterization.</p>
<div class="cell" data-execution_count="21">
<div class="cell-output cell-output-display" data-execution_count="22">
<div id="fig-two-models" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-two-models-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.8: Two different lines fit to the data. For each the residuals are computed, squared, then summed. The least-squares regression line is <em>the</em> line that makes this quantity minimal for a given data set.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Let <span class="math inline">\(f(x)\)</span> be some function, then a measure of the distance of the data to the line might be the sum <span class="math inline">\(\sum_i f(e_i)\)</span>. For example, using <span class="math inline">\(f(x) = |x|\)</span>, we have through <code>findmin</code>:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">F</span>(x) <span class="op">=</span> <span class="fu">abs</span>(x)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">resid_sum</span>(x, y, F, b0, b1) <span class="op">=</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(F, yi <span class="op">-</span> (b0 <span class="op">+</span> b1<span class="op">*</span>xi) <span class="cf">for</span> (xi,yi) <span class="kw">in</span> <span class="fu">zip</span>(x,y))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">j</span>(b0, b1) <span class="op">=</span> <span class="fu">resid_sum</span>(l, w, F, b0, b1)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> ys <span class="op">=</span> <span class="op">-</span><span class="fl">2</span> <span class="op">:</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span> <span class="op">:</span> <span class="fl">2</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>_, k <span class="op">=</span> <span class="fu">findmin</span>(<span class="fu">j</span>.(xs, ys<span class="op">'</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>(b0 <span class="op">=</span> xs[<span class="fu">first</span>(k.I)], b1 <span class="op">=</span> ys[<span class="fu">last</span>(k.I)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(b0 = 0.2, b1 = 0.0)</code></pre>
</div>
</div>
<p>This non-rigorously identifies the values of the coefficients that minimize the sum in <span class="math inline">\([-2,2]\times[-2,2]\)</span> by searching for the smallest over a grid with resolution <code>1/100</code>.</p>
<p>Using a different <span class="math inline">\(F\)</span> changes the answer:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">F</span>(x) <span class="op">=</span> x<span class="op">^</span><span class="fl">2</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">resid_sum</span>(x, y, f, b0, b1) <span class="op">=</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(f, yi <span class="op">-</span> (b0 <span class="op">+</span> b1<span class="op">*</span>xi) <span class="cf">for</span> (xi,yi) <span class="kw">in</span> <span class="fu">zip</span>(x,y))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">j</span>(b0, b1) <span class="op">=</span> <span class="fu">resid_sum</span>(l, w, F, b0, b1)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> ys <span class="op">=</span> <span class="op">-</span><span class="fl">2</span> <span class="op">:</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span> <span class="op">:</span> <span class="fl">2</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>_, k <span class="op">=</span> <span class="fu">findmin</span>(<span class="fu">j</span>.(xs, ys<span class="op">'</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>(b0 <span class="op">=</span> xs[<span class="fu">first</span>(k.I)], b1 <span class="op">=</span> ys[<span class="fu">last</span>(k.I)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>(b0 = -0.06, b1 = 0.21)</code></pre>
</div>
</div>
<p>When <span class="math inline">\(F(x) = x^2\)</span>, that is we seek to minimize the sum of the squared residuals, there is a mathematical formulation that can be solved to identify values for the constants. This is known as the <em>method of least squares</em>. There is a mathematical framework that this problem fits within that uses linear algebra.</p>
<p>Consider the <span class="math inline">\(n\)</span> linear equations of the form <span class="math inline">\(y_i = \beta_0 + \beta_1 x_i\)</span>. Written in a column form these are:</p>
<p><span class="math display">\[\begin{align*}
y_1 &amp; = \beta_0 + \beta_1 x_1\\
y_2 &amp; = \beta_0 + \beta_1 x_2\\
&amp; \vdots \\
y_n &amp; = \beta_0 + \beta_1 x_n\\
\end{align*}\]</span></p>
<p>There are 2 unknowns, <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. <em>Were</em> there two equations (<span class="math inline">\(n=2\)</span>), we could solve by substitution to find an expression for these in terms of <span class="math inline">\((x_1,y_1)\)</span> and <span class="math inline">\((x_2, y_2)\)</span>. We algebraically solve this below with the help of a symbolic math package:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">SymPy</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@syms</span> x[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>] y[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>] β[<span class="fl">0</span><span class="op">:</span><span class="fl">1</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>eqns <span class="op">=</span> [<span class="fu">one</span>.(x) x] <span class="op">*</span> β <span class="op">.~</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>2-element Vector{Sym}:
 x₁⋅β₁ + β₀ = y₁
 x₂⋅β₁ + β₀ = y₂</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(eqns, β)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>Dict{Any, Any} with 2 entries:
  β₁ =&gt; (y₁ - y₂)/(x₁ - x₂)
  β₀ =&gt; (x₁*y₂ - x₂*y₁)/(x₁ - x₂)</code></pre>
</div>
</div>
<p>Mathematically for the <em>linear problem</em>, this last line is equivalent to solving the equation <span class="math inline">\(A\beta=y\)</span> where <span class="math inline">\(A\)</span> is a <em>matrix</em> with one column of 1s and the other of <span class="math inline">\(x\)</span>:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="fu">one</span>.(x) x]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>2×2 Matrix{Sym}:
 1  x₁
 1  x₂</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">\</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>2-element Vector{Sym}:
 (x₁*y₂ - x₂*y₁)/(x₁ - x₂)
       (y₁ - y₂)/(x₁ - x₂)</code></pre>
</div>
</div>
<p>However, it is expected that there are more than 2 data points, so the line will in general be <em>overdetermined</em>. Symbolically, for really small <span class="math inline">\(n\)</span>, this can be solved symbolically:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@syms</span> x[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>] y[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>] β[<span class="fl">0</span><span class="op">:</span><span class="fl">1</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="fu">one</span>.(x) x]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(<span class="fu">sum</span>(<span class="cn">e</span><span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> <span class="cn">e</span> <span class="kw">in</span> A<span class="op">*</span>β <span class="op">-</span> y), β)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>2-element Vector{Tuple{Sym, Sym}}:
 (-x₁*β₁/3 - x₂*β₁/3 - x₃*β₁/3 + y₁/3 + y₂/3 + y₃/3 - sqrt(2)*sqrt(-x₁^2*β₁^2 + x₁*x₂*β₁^2 + x₁*x₃*β₁^2 + 2*x₁*y₁*β₁ - x₁*y₂*β₁ - x₁*y₃*β₁ - x₂^2*β₁^2 + x₂*x₃*β₁^2 - x₂*y₁*β₁ + 2*x₂*y₂*β₁ - x₂*y₃*β₁ - x₃^2*β₁^2 - x₃*y₁*β₁ - x₃*y₂*β₁ + 2*x₃*y₃*β₁ - y₁^2 + y₁*y₂ + y₁*y₃ - y₂^2 + y₂*y₃ - y₃^2)/3, β₁)
 (-x₁*β₁/3 - x₂*β₁/3 - x₃*β₁/3 + y₁/3 + y₂/3 + y₃/3 + sqrt(2)*sqrt(-x₁^2*β₁^2 + x₁*x₂*β₁^2 + x₁*x₃*β₁^2 + 2*x₁*y₁*β₁ - x₁*y₂*β₁ - x₁*y₃*β₁ - x₂^2*β₁^2 + x₂*x₃*β₁^2 - x₂*y₁*β₁ + 2*x₂*y₂*β₁ - x₂*y₃*β₁ - x₃^2*β₁^2 - x₃*y₁*β₁ - x₃*y₂*β₁ + 2*x₃*y₃*β₁ - y₁^2 + y₁*y₂ + y₁*y₃ - y₂^2 + y₂*y₃ - y₃^2)/3, β₁)</code></pre>
</div>
</div>
<p>The symbolic output isn’t pretty, but, with some calculus skills, the above approach algebraically yields these values for the <span class="math inline">\(\beta\)</span>s in terms of the data, <span class="math inline">\((x_i, y_i)\)</span>, for any <span class="math inline">\(n \geq 2\)</span>:</p>
<p><span class="math display">\[
\quad \hat{\beta}_1 = cor(x,y) \cdot \frac{s_y}{s_x}, \quad \hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x}.
\]</span></p>
<p>Numerically, the linear algebra problem implemented in the <code>\</code> operation used above solves the same least squares problem. So for our problem, we can get the coefficients via:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> [<span class="fu">one</span>.(l) l]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">\</span> w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>2-element Vector{Float64}:
 -0.048220327513871966
  0.20124509405873592</code></pre>
</div>
</div>
<p>For this identified line:</p>
<ul>
<li><p>the slope (<span class="math inline">\(\hat{\beta}_1\)</span>) is proportional to the correlation coefficient, the proportion being the ratio of the standard deviation in the response variable and standard deviation of the explanatory variable.</p></li>
<li><p>the point <span class="math inline">\((\bar{x}, \bar{y})\)</span> is on the line.</p></li>
<li><p>the coefficients can be computed efficiently through linear algebra</p></li>
</ul>
<p>The underlying machinery of linear algebra is given a different interface along with generalizations in the <code>GLM</code> <span class="citation" data-cites="GLM">(<a href="../references.html#ref-GLM" role="doc-biblioref">Bates et al. n.d.</a>)</span> package which implements the <em>linear</em> model through its <code>lm</code> function. We also add the <a href="https://github.com/JuliaStats/StatsModels.jl"><code>StatsModels</code></a> package, but this is included with <code>GLM</code>.</p>
<p>The statistical model to fit is specified through a formula defined using an interface from <code>StatsModels</code>. In this case the model is basically that <code>w</code> linearly depends on <code>l</code> and is written <code>w ~ l</code>, modeling the width of the petal in terms of the length.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsModels</span>, <span class="bu">GLM</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">fit</span>(LinearModel, <span class="pp">@formula</span>(y <span class="op">~</span> x), (y<span class="op">=</span>w, x<span class="op">=</span>l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

y ~ 1 + x

Coefficients:
───────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────────
(Intercept)  -0.0482203   0.121641   -0.40    0.6936  -0.292796    0.196356
x             0.201245    0.0826325   2.44    0.0186   0.0351012   0.367389
───────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The formula is written as a <em>macro</em>, so the variables do not need to be symbols, as they are not immediately evaluated because the macro transforms them first. Macros are processed <em>before</em> the values are known. Formulas are templates, the data specification in <code>lm</code> fills in that template. In the above, a standard formula for regression is specified, the data specification assigns <code>y</code> to <code>w</code> and <code>x</code> to <code>l</code>.</p>
<p>The combination of the generic <code>fit</code> method with the <code>LinearModel</code> type is implemented in the <code>lm</code> function, used hereafter.</p>
<p>In the following, we use names from the data frame created by <code>subset</code> in the formula.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">subset</span>(iris, <span class="op">:</span>Species <span class="op">=&gt;</span> <span class="fu">ByRow</span>(<span class="op">==</span>(<span class="st">"setosa"</span>)))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="pp">@formula</span>(PetalWidth <span class="op">~</span> PetalLength), d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

PetalWidth ~ 1 + PetalLength

Coefficients:
───────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────────
(Intercept)  -0.0482203   0.121641   -0.40    0.6936  -0.292796    0.196356
PetalLength   0.201245    0.0826325   2.44    0.0186   0.0351012   0.367389
───────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The output has more detail to be explained later. For now, we only need to know that the method <code>coef</code> will extract the coefficients (in the first column) as a vector of length 2, which we assign to the values <code>bhat0</code> and <code>bhat1</code> below:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(<span class="fu">jitter</span>(l), <span class="fu">jitter</span>(w); legend<span class="op">=</span><span class="cn">false</span>)  <span class="co"># spread out values</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>bhat0, bhat1 <span class="op">=</span> <span class="fu">coef</span>(res)                     <span class="co"># the coefficients</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> bhat0 <span class="op">+</span> bhat1 <span class="op">*</span> x)                <span class="co"># `predict` does this generically</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<p><img src="bivariate-julia_files/figure-html/cell-33-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A constant model
</div>
</div>
<div class="callout-body-container callout-body">
<p>The linear model has much wider applicability than the <em>simple</em> regression model, <span class="math inline">\(y_i = \beta_0 + \beta_1 x_i + \epsilon_i\)</span>. To see one example, we can fit the model <span class="math inline">\(y_i = \beta_0 + \epsilon_i\)</span> using least squares:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="pp">@formula</span>(y <span class="op">~</span> <span class="fl">1</span>), (y<span class="op">=</span>l,)) <span class="op">|&gt;</span> coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>1-element Vector{Float64}:
 1.462</code></pre>
</div>
</div>
<p>The estimate is the <code>mean</code> of <code>l</code>.</p>
</div>
</div>
</section>
<section id="local-regression" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="local-regression"><span class="header-section-number">4.2.3</span> Local regression</h3>
<p>The method of least squares used above is called “regression.” It was popularized by Galton <span class="citation" data-cites="GALTON_10.2307/2841583">(<a href="../references.html#ref-GALTON_10.2307/2841583" role="doc-biblioref">Galton 1886</a>)</span> along with the phrase “regression to the mean.” The method of local regression (LOESS, with SS meaning scatterplot smoothing) essentially fits a regression line (or a degree <span class="math inline">\(d\)</span> polynomial) to parts of the data then stitches them together. The result is a curve that summarizes any trend in the data between the response variable and the explanatory variable. <a href="#fig-loess-explanation">Figure&nbsp;<span>4.9</span></a> shows some <em>locally</em> fit regression lines on the left, and on the right an identified <code>loess</code> line to show that the loess line here mostly follows the local regression models. The “loess” line was added to with these commands from the <code>Loess</code> package, which are wrapped up into a function to call later:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Loess   </span><span class="co"># import so as not to conflict with other loaded packages</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">loess_line!</span>(p, x, y; normalize<span class="op">=</span><span class="cn">true</span>, span<span class="op">=</span><span class="fl">0.75</span>, degree<span class="op">=</span><span class="fl">2</span>, kwargs<span class="op">...</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> Loess.<span class="fu">loess</span>(x, y; normalize<span class="op">=</span>normalize, span<span class="op">=</span>span, degree<span class="op">=</span>degree)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">extrema</span>(x)<span class="op">...</span>, length<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot!</span>(p, us, Loess.<span class="fu">predict</span>(model, us); kwargs<span class="op">...</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>loess_line! (generic function with 1 method)</code></pre>
</div>
</div>
<p>The default value of the <code>degree</code> keyword is <code>2</code> for a <em>quadratic</em> fit to the data.</p>
<div class="cell" data-execution_count="35">
<div class="cell-output cell-output-display" data-execution_count="36">
<div id="fig-loess-explanation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-loess-explanation-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.9: On left, a scatter plot with some local regression lines (based on 10 points) layered on; on right, the same with a degree 1 <code>loess</code> line added.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="robust-linear-models" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="robust-linear-models"><span class="header-section-number">4.2.4</span> Robust linear models</h3>
<p>The formula for the slope of the simple regression coefficient depends on <span class="math inline">\(s_y/s_x\)</span>. The sample standard deviations may be influenced greatly by as few as one outlying value. That is, they are not very resistant to outliers. A theory of <em>robust linear models</em> has been developed which are useful in allowing a relaxation on the standard distributional assumptions, relaxations that accommodate data with more outliers. The <code>RobustModels</code> package implements a number of such models, of which we illustrate just <code>MEstimator{TukeyLoss}</code> without comment as to the implemented algorithm.</p>
<p>One way to view data sets that benefit from robust models is to envision a process where the measured response values are given by the value on a regression line <em>plus</em> some “normally” distributed error <strong>plus</strong> some “contaminated” error which introduces outliers.</p>
<p>To simulate that in our length and width data, we simply add in a contaminant to some of the terms below which appear in <a href="#fig-robust-regression">Figure&nbsp;<span>4.10</span></a> in the upper-right corner. That figure shows the least-squares regression line is influenced by the 3 contaminated points, but that robust regression line is not.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>w′ <span class="op">=</span> <span class="fu">jitter</span>(w)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>l′ <span class="op">=</span> <span class="fu">jitter</span>(l)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="fu">sortperm</span>(l′)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>w′, l′ <span class="op">=</span> w′[idx], l′[idx]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>sigma_e <span class="op">=</span> <span class="fu">dispersion</span>(res.model) <span class="co"># sqrt(deviance(res)/dof_residual(res))</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>inds <span class="op">=</span> [<span class="fl">45</span>, <span class="fl">48</span>, <span class="fl">50</span>]             <span class="co"># some indices</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>w′[inds] <span class="op">=</span> w<span class="op">'</span>[inds] <span class="op">.+</span> <span class="fl">5</span><span class="op">*</span>sigma_e  <span class="co"># contaminate 3 values</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> <span class="fu">fill</span>(<span class="st">"blue"</span>, <span class="fl">50</span>); color[inds] <span class="op">.=</span> <span class="st">"red"</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(l′, w′; legend<span class="op">=:</span>topleft, color<span class="op">=</span>color)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>fm <span class="op">=</span> <span class="pp">@formula</span>(w <span class="op">~</span> l)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(fm, (w<span class="op">=</span>w′, l<span class="op">=</span>l′))</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">minimum</span>(l′), <span class="fu">maximum</span>(l′), <span class="fl">100</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(us, GLM.<span class="fu">predict</span>(res, (l<span class="op">=</span>us,)); linewidth<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"lm"</span>)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">RobustModels</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> RobustModels.<span class="fu">MEstimator</span><span class="dt">{RobustModels.TukeyLoss}</span>()</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>res_robust <span class="op">=</span> RobustModels.<span class="fu">rlm</span>(fm, (w<span class="op">=</span>w′, l<span class="op">=</span>l′), estimator)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(us, RobustModels.<span class="fu">predict</span>(res_robust, (l<span class="op">=</span>us,)); linewidth<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"rlm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div id="fig-robust-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-robust-regression-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.10: The three data points in the upper right of this graphic are “contaminated” data. Their outlying nature has undue influence on the least-squares regression line (“lm”) pulling it up towards the points. The robust regression line (“rlm”) is not so influenced.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prediction" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="prediction"><span class="header-section-number">4.2.5</span> Prediction</h3>
<p>In the definition of <code>loess_line!</code> and <a href="#fig-robust-regression">Figure&nbsp;<span>4.10</span></a> a <code>predict</code> method from various packages was used to plot the trend line. The pattern was similar: <code>predict(model, (l=data,))</code> created <span class="math inline">\(y\)</span> values for the given explanatory values.</p>
<p>The language comes from the usage of statistical models.</p>
<p>The explanatory “variable”, in general, may consist of 0, 1, or more variables. Examples with 0 or 1 for <code>lm</code> were given. It is not hard to envision in the <code>iris</code> data that the petal length might be influenced by the species, the petal width, and even details of the sepal sizes. The word explanatory hints that the <span class="math inline">\(y\)</span> values should be somehow explained by the covariates. Of course, statistical data is typically subject to variability, so even if all covariates are equal, different responses need not be the same. A statistical model may account for this by expressing a relationship:</p>
<blockquote class="blockquote">
<p>response = predicted + error</p>
</blockquote>
<p>For our purposes, the “predicted” part comes from some parameterized function of the covariates and forms the structural model for the data. <em>On average</em>, it is assumed the errors are <span class="math inline">\(0\)</span>, but that an individual error introduces some randomness.</p>
<p>The parameters in the model are fitted by some process (such as <code>lm</code>) leaving the related decomposition</p>
<blockquote class="blockquote">
<p>response = fitted + residual</p>
</blockquote>
<p>In <code>GLM</code> and other packages within the <code>Julia</code> ecosystem, the aptly named generic <code>fit</code> method is used to fit a model.</p>
<p>The “fitted” and “residual” values are based on the data and are known quantities; the “predicted” and “error” are postulated and may be unknowable. It is common to use the identified model as estimates for predicted values.</p>
<p>In the above examples, the <code>predict</code> method was used to do just that. The syntax for <code>predict</code> may have seemed more complicated than needed, but the model may have many covariates, so the specification needs a means to identify them. A <code>Tables</code> compatible specification of the data used in the prediction is used, in the above that was a named tuple.</p>
<p>The modeling environment of <code>Julia</code> has these generic methods for the parts of a model:</p>
<ul>
<li><code>predict(model, newdata)</code>: Make predictions for new values of the covariate(s).</li>
<li><code>fitted(model)</code>: The predicted values for the covariate(s) used to identify the parameters in the model.</li>
<li><code>response(model)</code>: The response values</li>
<li><code>residuals(model)</code>: The response values minus the fitted values</li>
</ul>
<p>The residuals are not the errors, but give a sense of them. The <code>residuals</code> function returns the residual values for a model fit. For example, we have these summaries:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">residuals</span>(res)), <span class="fu">std</span>(<span class="fu">residuals</span>(res))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>(0.0, 0.41497564411296994)</code></pre>
</div>
</div>
<p>(The mean of the residuals is <strong>always</strong> 0 for a linear model, a consequence of the method of least squares.)</p>
</section>
<section id="assessing-the-residuals" class="level3" data-number="4.2.6">
<h3 data-number="4.2.6" class="anchored" data-anchor-id="assessing-the-residuals"><span class="header-section-number">4.2.6</span> Assessing the residuals</h3>
<p>In the creation of <a href="#fig-robust-regression">Figure&nbsp;<span>4.10</span></a> the following value was used:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sigma_e <span class="op">=</span> <span class="fu">dispersion</span>(res.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.4192760247125827</code></pre>
</div>
</div>
<p>This is the square root of the sum of the squared residuals (computed by <code>deviance</code>) divided by the <em>degrees of freedom</em> (in this case <span class="math inline">\(n-2\)</span>, but in general given by <code>dof_residual</code>):</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> <span class="fu">deviance</span>(res) <span class="op">/</span> <span class="fu">dof_residual</span>(res) <span class="co"># sense of scale</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.4192760247125827</code></pre>
</div>
</div>
<p>For the simple linear regression model, the value <span class="math inline">\(\sum e_i^2\)</span> is minimized by the choice of the estimates for the <span class="math inline">\(\beta\)</span>s. This value is called the SSE, or sum of squared errors (or the SSR, sum of squared residuals). It can be found from the residuals <em>or</em> the generic method <code>deviance</code>:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ei<span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> ei <span class="kw">in</span> <span class="fu">residuals</span>(res)), <span class="fu">deviance</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>(8.438034475141741, 8.438034475141741)</code></pre>
</div>
</div>
<p>The deviance gives a sense of scale, but does not reflect the size of the data set, <span class="math inline">\(n\)</span>. The residual <em>degrees of freedom</em> of a model is <span class="math inline">\(n-k -1\)</span> where <span class="math inline">\(k\)</span> is the number of variables. Assuming an intercept, in simple linear regression <span class="math inline">\(k=1\)</span></p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="fu">length</span>(l) <span class="co"># or nobs(res)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu">dof_residual</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>(48, 48.0)</code></pre>
</div>
</div>
<p>(More generally, this is <span class="math inline">\(n\)</span> minus the number of columns in the model matrix, which for this model is one for the intercept and one for the <span class="math inline">\(x\)</span> values.)</p>
<p>The <em>mean squared error</em> (MSE) is the ratio of the SSE and the degrees of freedom, or <span class="math inline">\((\sum e_i^2)/(n-k-1)\)</span>. This is like a sample variance for the error terms, the square root of it, <em>like</em> the standard deviation, a also measure of variability.</p>
<p>The residuals can be used to graphically assess the ability of the fitted model used to describe the data. There are a few standard graphics:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<ul>
<li>A fitted versus residuals plot. The residuals are the data less the structural part of the model. If the model fits well, the residuals should not show a pattern.</li>
<li>A quantile plot of the residuals. For statistical inference, there are distributional assumptions made on the error values. This plot helps assess if typical assumption on the shape is valid.</li>
<li>A scale location. For statistical inference, there are distributional assumptions made on the error values. This plot helps assess if typical assumption of equal variances is valid.</li>
<li>Residuals versus leverage. As regression can be sensitive to influential outliers. This is assessed with Cook’s distance which measures the change if point is used to fit the data compared to if it is not.</li>
</ul>
<p>The support for these graphics in <code>Julia</code> is not as developed as in <code>R</code>, say. As such, we create some simple functions for generating this plots.</p>
<p>We first define several helper functions:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>: diag</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hat</span>(res) <span class="op">=</span> (X <span class="op">=</span> <span class="fu">modelmatrix</span>(res); X <span class="op">*</span> <span class="fu">inv</span>(<span class="fu">crossmodelmatrix</span>(res)) <span class="op">*</span> X<span class="op">'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hatvalues</span>(res) <span class="op">=</span> <span class="fu">diag</span>(<span class="fu">hat</span>(res))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">rstandard</span>(res)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> [ei<span class="op">/</span><span class="fu">sqrt</span>(<span class="fl">1</span><span class="op">-</span>hi) for (ei, hi) <span class="kw">in</span> <span class="fu">zip</span>(<span class="fu">residuals</span>(res), <span class="fu">hatvalues</span>(res))]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="fu">dispersion</span>(res)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    es <span class="op">/</span> s</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>rstandard (generic function with 1 method)</code></pre>
</div>
</div>
<p>The <code>hat</code> function computes a matrix that arises in the regression model, its diagonal entries are returned by <code>hatvalues</code>. These are used to scale the residuals to produce the <em>standardized residuals</em>, computed by <code>rstandard</code>. The generic <code>leverage</code>, defined in <code>StatsBase</code>, is intended to compute what <code>hatvalues</code> does, but it currently doesn’t have a method defined in <code>GLM</code>.</p>
<p>The 4 basic diagnostic plots follow those returned by default in R, though the R versions offer more insight into outlying values. In <a href="#fig-diagnostic-plots">Figure&nbsp;<span>4.11</span></a> the 4 graphics are shown for the “setosa” species data with PetalWidth modeled by PetalLength.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fitted_versus_residuals</span>(res)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> <span class="fu">plot</span>(; legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scatter!</span>(p, <span class="fu">fitted</span>(res), <span class="fu">residuals</span>(res);</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  xlab<span class="op">=</span><span class="st">"Fitted"</span>, ylab<span class="op">=</span><span class="st">"Residuals"</span>, title<span class="op">=</span><span class="st">"Residuals vs. fitted"</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loess_line!</span>(p, <span class="fu">fitted</span>(res), <span class="fu">residuals</span>(res))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">quantile_residuals</span>(res)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qqnorm</span>(<span class="fu">rstandard</span>(res);</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>       legend<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>       title <span class="op">=</span> <span class="st">"Normal Q-Q"</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>       xlab<span class="op">=</span><span class="st">"Theoretical quantiles"</span>, ylab<span class="op">=</span><span class="st">"Standardized residuals"</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">scale_location_plot</span>(res)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> <span class="fu">fitted</span>(res), <span class="fu">rstandard</span>(res)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fu">sqrt</span>.(<span class="fu">abs</span>.(y))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">plot</span>(; legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(p, x, y;</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Scale location"</span>,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        xlab<span class="op">=</span><span class="st">"Fitted"</span>, ylab <span class="op">=</span> <span class="st">"Standardized residuals"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">loess_line!</span>(p, x, y)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    p</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">residual_leverage</span>(res)</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>   x, y <span class="op">=</span> <span class="fu">cooksdistance</span>(res), <span class="fu">rstandard</span>(res)</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>   p <span class="op">=</span> <span class="fu">plot</span>(; legend<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scatter!</span>(p, x, y;</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Residuals vs. leverage"</span>,</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    xlab<span class="op">=</span><span class="st">"Leverage"</span>, ylab<span class="op">=</span><span class="st">"Standardized residuals"</span>)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>   <span class="fu">loess_line!</span>(p, x, y)</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>   p</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>residual_leverage (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="cell-output cell-output-display" data-execution_count="45">
<div id="fig-diagnostic-plots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-diagnostic-plots-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.11: Four diagnostic plots, following the standard ones of R</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Alternatives
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the above, we created functions to compute some diagnostic values. These are also defined in the <code>LinRegOutliers</code> package <span class="citation" data-cites="LinRegOutliers">(<a href="../references.html#ref-LinRegOutliers" role="doc-biblioref">al. 2021</a>)</span> along with much else. However, the interface is not quite compatible with the model results of <code>lm</code>, so we didn’t leverage that work here.</p>
</div>
</div>
</section>
<section id="transformations" class="level3" data-number="4.2.7">
<h3 data-number="4.2.7" class="anchored" data-anchor-id="transformations"><span class="header-section-number">4.2.7</span> Transformations</h3>
<p>The <code>lm</code> function, as used above, expects <em>linear</em> relationships between the explanatory variable and the response variable. That is, a model of the type <span class="math inline">\(y = \beta_0 + \beta_1 x + \epsilon\)</span>. There may be data for which some mathematical transformation is necessary in order to get this structural form.</p>
<p>The <code>animals</code> data set, defined below, measures the body size and brain size of various species of animals. The brain size depends on the body size, but it seems to be non-linear and better modeled by <span class="math inline">\(e^y = e^{\beta_0 + \beta_1 x + \epsilon}\)</span>. In <a href="#fig-animals-plots">Figure&nbsp;<span>4.12</span></a> we can see scatter plots of the two data sets before and after a log transform.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>animals <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"MASS"</span>, <span class="st">"Animals"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">transform!</span>(animals, [<span class="op">:</span>Brain, <span class="op">:</span>Body] <span class="op">.=&gt;</span> <span class="fu">ByRow</span>(log) <span class="op">.=&gt;</span> [<span class="op">:</span>logBrain, <span class="op">:</span>logBody])</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="pp">@df</span> animals <span class="fu">scatter</span>(<span class="op">:</span>Body, <span class="op">:</span>Brain; legend<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                         title<span class="op">=</span><span class="st">"Brain by body"</span>, xlab<span class="op">=</span><span class="st">"Body"</span>, ylab<span class="op">=</span><span class="st">"Brain"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="pp">@df</span> animals <span class="fu">scatter</span>(<span class="op">:</span>logBody, <span class="op">:</span>logBrain; legend<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                         title<span class="op">=</span><span class="st">"log(Brain) by log(body)"</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                         xlab<span class="op">=</span><span class="st">"log(Body)"</span>, ylab<span class="op">=</span><span class="st">"log(Brain)"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p1, p2; layout <span class="op">=</span> (<span class="pp">@layout</span> [a b]))<span class="co">#, size=fig_size_2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div id="fig-animals-plots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-animals-plots-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.12: Plot of <code>animals</code> data before and after log transform of the body and brain variables.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>There is an <em>automated</em> group of transformations called <em>power transformations</em>; these are implemented in the <code>BoxCoxTrans</code> package. Its <code>transform</code> function identifies an appropriate monotonic transformation. We can see the results of the transformations of both variables here along with a regression line and a robust regression line:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">BoxCoxTrans</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">transform!</span>(animals, [<span class="op">:</span>Brain,<span class="op">:</span>Body] <span class="op">.=&gt;</span> BoxCoxTrans.transform <span class="op">.=&gt;</span> [<span class="op">:</span>bcBrain, <span class="op">:</span>bcBody])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="pp">@df</span> animals <span class="fu">scatter</span>(<span class="op">:</span>bcBody, <span class="op">:</span>bcBrain; label<span class="op">=</span><span class="cn">nothing</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                        title <span class="op">=</span> <span class="st">"Animals, Box-Cox transformed"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                        xlab <span class="op">=</span> <span class="st">"box-cox Body"</span>, ylab <span class="op">=</span> <span class="st">"box-cox Brain"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>fm <span class="op">=</span> <span class="pp">@formula</span>(bcBrain <span class="op">~</span> bcBody)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(fm,  animals)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> RobustModels.<span class="fu">MEstimator</span><span class="dt">{RobustModels.TukeyLoss}</span>()</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>res_robust <span class="op">=</span> RobustModels.<span class="fu">rlm</span>(fm, animals, estimator)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">extrema</span>(animals.bcBody)<span class="op">...</span>, length<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(us, GLM.<span class="fu">predict</span>(res, (bcBody <span class="op">=</span> us,)), linewidth<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"lm"</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(us, RobustModels.<span class="fu">predict</span>(res_robust, (bcBody <span class="op">=</span> us,)), linewidth<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"rlm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div id="fig-box-cox-animals" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-box-cox-animals-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.13: The <code>animals</code> data after both the <code>Body</code> and <code>Brain</code> variables have been transformed through the Box-Cox method. This data set has 3 outliers that pull the <code>lm</code> regression line downward, but do not impact the robust regression line, which more accurately captures the trend for all but the 3 outliers (which happen to be dinosaur species).</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="grouping-by-a-categorical-variable" class="level3" data-number="4.2.8">
<h3 data-number="4.2.8" class="anchored" data-anchor-id="grouping-by-a-categorical-variable"><span class="header-section-number">4.2.8</span> Grouping by a categorical variable</h3>
<p>The <code>iris</code> data is an example of differences between the species, one more so than the other. The <code>group</code> argument to <code>scatter</code> instructs the coloring of the markers to vary across the values of the grouping variable, effectively showing three variables at once.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>p_scatter <span class="op">=</span> <span class="pp">@df</span> iris <span class="fu">scatter</span>(<span class="op">:</span>PetalWidth, <span class="op">:</span>PetalLength; group<span class="op">=:</span>Species,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>      legend<span class="op">=</span><span class="cn">false</span>, alpha<span class="op">=</span><span class="fl">0.33</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <a href="#fig-iris-scatterplot-regression">Figure&nbsp;<span>4.14</span></a> the basic scatter plot for petal width modeled by petal length is shown in the left figure along with a fitted regression line. We set an <code>alpha</code> value for the scatterplot to better see the regression lines. The line itself was prepared with:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(PetalLength <span class="op">~</span> PetalWidth), iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

PetalLength ~ 1 + PetalWidth

Coefficients:
───────────────────────────────────────────────────────────────────────
               Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────
(Intercept)  1.08356   0.072967   14.85    &lt;1e-30   0.939366    1.22775
PetalWidth   2.22994   0.0513962  43.39    &lt;1e-85   2.12838     2.33151
───────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">extrema</span>(iris.PetalWidth)<span class="op">...</span>, <span class="fl">100</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>vs <span class="op">=</span> <span class="fu">predict</span>(m1, (PetalWidth <span class="op">=</span> us, ))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(p_scatter, us, vs; title<span class="op">=</span><span class="st">"iris data"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The three clusters can influence the regression line fit to the scatter plot, that is <code>species</code> can be an influence, as would be expected. There are different ways for this expectation to be incorporated.</p>
<p>First, suppose we simply adjust the fitted lines up or down for each cluster. That is, there is some additive effect for each type of species. As a example of something we discuss at more length later, we can fit this model by including <code>Species</code> as an additive term:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(PetalLength <span class="op">~</span> PetalWidth <span class="op">+</span> Species), iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

PetalLength ~ 1 + PetalWidth + Species

Coefficients:
───────────────────────────────────────────────────────────────────────────────
                       Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────────────
(Intercept)          1.2114    0.0652419  18.57    &lt;1e-39   1.08246     1.34034
PetalWidth           1.01871   0.152242    6.69    &lt;1e-09   0.717829    1.31959
Species: versicolor  1.69779   0.180948    9.38    &lt;1e-15   1.34018     2.05541
Species: virginica   2.27669   0.281325    8.09    &lt;1e-12   1.7207      2.83269
───────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The second row in the output of <code>m2</code> has an identical interpretation as for <code>m1</code> – it is the slope of the regression line. The first line of the output in <code>m1</code> is the <span class="math inline">\(x\)</span>-intercept, which moves the line up or down. Whereas the first of <code>m2</code> is the <span class="math inline">\(x\)</span> intercept for a line that describes <em>just one</em> of the species, in this case <code>setosa</code>. (A coding for the regression model with a categorical variable chooses one reference level, in this case “setosa.”). The 3rd and 4th lines are the slopes for the other two species.</p>
<p>We can plot these individually, one-by-one, in a similar manner as before, however when we call <code>predict</code> we include a level for <code>:Species</code>. The result is the middle figure in <a href="#fig-iris-scatterplot-regression">Figure&nbsp;<span>4.14</span></a>.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>p_scatter2 <span class="op">=</span> <span class="fu">deepcopy</span>(p_scatter)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> <span class="fu">groupby</span>(iris, <span class="op">:</span>Species)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k,d) <span class="op">∈</span> <span class="fu">pairs</span>(gdf)   <span class="co"># GroupKey, SubDataFrame</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="fu">string</span>(k.Species)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">extrema</span>(d.PetalWidth)<span class="op">...</span>, <span class="fl">100</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    vs <span class="op">=</span> <span class="fu">predict</span>(m2, <span class="fu">DataFrame</span>(PetalWidth<span class="op">=</span>us, Species<span class="op">=</span>s))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(p_scatter2, us, vs; linewidth<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ow we identify different regression lines (slope and intercepts) for each cluster. This is done throuh a <em>multiplicative</em> model and is specified in the model formula of <code>StatsModels</code> with a <code>*</code>:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(PetalLength <span class="op">~</span> PetalWidth <span class="op">*</span> Species), iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

PetalLength ~ 1 + PetalWidth + Species + PetalWidth &amp; Species

Coefficients:
─────────────────────────────────────────────────────────────────────────────────────────────
                                     Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
─────────────────────────────────────────────────────────────────────────────────────────────
(Intercept)                       1.32756     0.130933  10.14    &lt;1e-17   1.06877     1.58636
PetalWidth                        0.54649     0.490003   1.12    0.2666  -0.422038    1.51502
Species: versicolor               0.453712    0.373701   1.21    0.2267  -0.284935    1.19236
Species: virginica                2.91309     0.406031   7.17    &lt;1e-10   2.11054     3.71564
PetalWidth &amp; Species: versicolor  1.32283     0.555241   2.38    0.0185   0.225359    2.42031
PetalWidth &amp; Species: virginica   0.100769    0.524837   0.19    0.8480  -0.936611    1.13815
─────────────────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The first four coefficients are interpreted similarly to those for <code>m2</code>, the remaining 2 summarize the interaction between the petal width and the species type.</p>
<p>We can produce a graphic, the right-most figure in <a href="#fig-iris-scatterplot-regression">Figure&nbsp;<span>4.14</span></a>:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>p_scatter3 <span class="op">=</span> <span class="fu">deepcopy</span>(p_scatter)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> <span class="fu">groupby</span>(iris, <span class="op">:</span>Species)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k,d) <span class="op">∈</span> <span class="fu">pairs</span>(gdf)   <span class="co"># GroupKey, SubDataFrame</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="fu">string</span>(k.Species)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    us <span class="op">=</span> <span class="fu">range</span>(<span class="fu">extrema</span>(d.PetalWidth)<span class="op">...</span>, <span class="fl">100</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    vs <span class="op">=</span> <span class="fu">predict</span>(m3, <span class="fu">DataFrame</span>(PetalWidth<span class="op">=</span>us, Species<span class="op">=</span>s))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(p_scatter3, us, vs; linewidth<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="54">
<div class="cell-output cell-output-display" data-execution_count="55">
<div id="fig-iris-scatterplot-regression" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="bivariate-julia_files/figure-html/fig-iris-scatterplot-regression-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.14: Three scatterplots of petal width by petal length in the <code>iris</code> data set. The right-hand figure includes the regression line fit to all the data. The middle one fits regression lines identified through an additive model that includes the species. The slopes are parallel, but the lines have an additive shift. The right figure shows a multiplicative model wherein the slopes and intercepts for each species are chosen.</figcaption><p></p>
</figure>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-LinRegOutliers" class="csl-entry" role="doc-biblioentry">
al., S. et (2021), <span>“LinRegOutliers: A julia package for detecting outliers in linear regression,”</span> <em>Journal of Open Source Software</em>, 6. <a href="https://doi.org/10.21105/joss.02892">https://doi.org/10.21105/joss.02892</a>.
</div>
<div id="ref-GLM" class="csl-entry" role="doc-biblioentry">
Bates, D., and others (n.d.). <em>GLM.jl</em>. <a href="https://doi.org/10.5281">https://doi.org/10.5281</a>.
</div>
<div id="ref-GALTON_10.2307/2841583" class="csl-entry" role="doc-biblioentry">
Galton, F. (1886), <span>“<a href="http://www.jstor.org/stable/2841583">Regression towards mediocrity in hereditary stature.</a>”</span> <em>The Journal of the Anthropological Institute of Great Britain and Ireland</em>, [Royal Anthropological Institute of Great Britain; Ireland, Wiley], 15, 246–263.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>For the <code>Makie</code> plotting package, the <code>AlgebraOfGraphics</code> package is a powerful alternative to <code>StatsPlots</code> and reminiscent of R’s <code>ggplot</code> system. We will illustrate its use in a later chapter.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>These are graphics that R uses with linear models.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../EDA/tabular-data-julia.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tabular data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../EDA/categorical-data-julia.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">© Copyright 2023, John Verzani. All rights reserved.</div>
  </div>
</footer>



</body></html>