<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Julia for Introductory Statistics - 6&nbsp; The AlgebraOfGraphics package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Inference/distributions.html" rel="next">
<link href="../EDA/categorical-data-julia.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KS515LKBGZ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-KS515LKBGZ', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The <code>AlgebraOfGraphics</code> package</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Using Julia for Introductory Statistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jverzani/UsingJ" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/univariate-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Univariate data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/tabular-data-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tabular data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/bivariate-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bivariate data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/categorical-data-julia.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/makie.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The <code>AlgebraOfGraphics</code> package</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/distributions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability distributions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/inference.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LinearModels/linear-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The linear regression model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#univariate-graphical-summaries" id="toc-univariate-graphical-summaries" class="nav-link active" data-scroll-target="#univariate-graphical-summaries"><span class="toc-section-number">6.1</span>  Univariate graphical summaries</a>
  <ul class="collapse">
  <li><a href="#boxplot-and-violin-plot" id="toc-boxplot-and-violin-plot" class="nav-link" data-scroll-target="#boxplot-and-violin-plot"><span class="toc-section-number">6.1.1</span>  Boxplot and violin plot</a></li>
  <li><a href="#dot-plot" id="toc-dot-plot" class="nav-link" data-scroll-target="#dot-plot"><span class="toc-section-number">6.1.2</span>  Dot plot</a></li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"><span class="toc-section-number">6.1.3</span>  Faceting</a></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms"><span class="toc-section-number">6.1.4</span>  Histograms</a></li>
  <li><a href="#density-plot" id="toc-density-plot" class="nav-link" data-scroll-target="#density-plot"><span class="toc-section-number">6.1.5</span>  Density plot</a></li>
  <li><a href="#quantile-normal-plots" id="toc-quantile-normal-plots" class="nav-link" data-scroll-target="#quantile-normal-plots"><span class="toc-section-number">6.1.6</span>  Quantile-normal plots</a></li>
  </ul></li>
  <li><a href="#line-plots" id="toc-line-plots" class="nav-link" data-scroll-target="#line-plots"><span class="toc-section-number">6.2</span>  Line plots</a></li>
  <li><a href="#bivariate-relationships" id="toc-bivariate-relationships" class="nav-link" data-scroll-target="#bivariate-relationships"><span class="toc-section-number">6.3</span>  Bivariate relationships</a>
  <ul class="collapse">
  <li><a href="#corner-plot" id="toc-corner-plot" class="nav-link" data-scroll-target="#corner-plot"><span class="toc-section-number">6.3.1</span>  Corner plot</a></li>
  <li><a href="#d-scatterplots" id="toc-d-scatterplots" class="nav-link" data-scroll-target="#d-scatterplots"><span class="toc-section-number">6.3.2</span>  3D scatterplots</a></li>
  </ul></li>
  <li><a href="#categorical-data" id="toc-categorical-data" class="nav-link" data-scroll-target="#categorical-data"><span class="toc-section-number">6.4</span>  Categorical data</a></li>
  <li><a href="#customizing-plots-through-axis" id="toc-customizing-plots-through-axis" class="nav-link" data-scroll-target="#customizing-plots-through-axis"><span class="toc-section-number">6.5</span>  Customizing plots through <code>axis</code></a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jverzani/UsingJ/edit/master/EDA/makie.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jverzani/UsingJ/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The <code>AlgebraOfGraphics</code> package</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The <code>StatsPlots</code> package has been used to illustrate the standard graphics of exploratory statistics. That package leverages <code>Plots</code>, a <code>Julia</code> interface to multiple plotting backends. The <code>GR</code> one renders the images seen. There are a few alternatives. The <code>Makie</code> <span class="citation" data-cites="DanischKrumbiegel2021">(<a href="../references.html#ref-DanischKrumbiegel2021" role="doc-biblioref">Danisch and Krumbiegel 2021</a>)</span> plotting system along with the <code>AlgebraOfGraphics</code> <span class="citation" data-cites="AoG">(<a href="../references.html#ref-AoG" role="doc-biblioref">Vertechi et al. n.d.</a>)</span> package makes a very compelling one.</p>
<p>The <code>AlgebraOfGraphics</code> packages offers a <em>declarative</em> style to create statistical graphics. An example from the <a href="https://aog.makie.org/stable/philosophy/">documentation</a> shows the code to do the following “declare the dataset; declare the analysis; declare the arguments used; declare the grouping and the respective visual attribute; draw the visualization.” This is all done through a series of composable commands, illustrated by example below. The Pumas project has a much more extensive <a href="https://tutorials.pumas.ai/html/PlottingInJulia/">tutorial</a> than is presented here.</p>
<p>We will see that it is very easy to visualize multiple variables through an appropriate choice of graphic or transformation, with further choices of coloring, faceting, or other means to demarcate different factors. The “declarative” style shines here, as the user simply specifies a variable, and the package converts this, as needed, to a color or shape .</p>
<p>We begin by loading the packages. The <code>CairoMakie</code> backend is used here, <code>GLMakie</code>is good for interactive usage at the command line, <code>WGLMakie</code> is for web-based graphics, all are part of the same <code>Makie</code> plotting ecosystem.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span>, <span class="bu">DataFrames</span>, <span class="bu">CategoricalArrays</span>, <span class="bu">RDatasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span>, <span class="bu">AlgebraOfGraphics</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set_aog_theme!</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the color theme of <code>aog</code>, as declared in the last command. The packages are compute-intensive and can take a while to load.</p>
<p>Following the package <a href="docs.juliahub.com/AlgebraOfGraphics/">tutorial</a>, we load the <a href="https://github.com/allisonhorst/palmerpenguins">Palmer penguins</a> data set of Allison Horst. This includes data collected and made available by Dr.&nbsp;Kristen Gorman and the Palmer Station, Antarctica LTER, a member of the Long Term Ecological Research Network. The data can be downloaded from the GitHub site, but it is also wrapped into a <code>Julia</code> package:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PalmerPenguins</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> <span class="fu">dropmissing</span>(<span class="fu">DataFrame</span>(PalmerPenguins.<span class="fu">load</span>()))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(penguins, <span class="fl">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div><div style="float: left;"><span>3×7 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;"><table class="data-frame table table-sm table-striped" style="margin-bottom: 6px;"><thead><tr class="header"><th class="rowNumber" style="font-weight: bold; text-align: right;">Row</th><th style="text-align: left;">species</th><th style="text-align: left;">island</th><th style="text-align: left;">bill_length_mm</th><th style="text-align: left;">bill_depth_mm</th><th style="text-align: left;">flipper_length_mm</th><th style="text-align: left;">body_mass_g</th><th style="text-align: left;">sex</th></tr><tr class="subheader headerLastRow"><th class="rowNumber" style="font-weight: bold; text-align: right;"></th><th title="InlineStrings.String15" style="text-align: left;">String15</th><th title="InlineStrings.String15" style="text-align: left;">String15</th><th title="Float64" style="text-align: left;">Float64</th><th title="Float64" style="text-align: left;">Float64</th><th title="Int64" style="text-align: left;">Int64</th><th title="Int64" style="text-align: left;">Int64</th><th title="InlineStrings.String7" style="text-align: left;">String7</th></tr></thead><tbody><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">1</td><td style="text-align: left;">Adelie</td><td style="text-align: left;">Torgersen</td><td style="text-align: right;">39.1</td><td style="text-align: right;">18.7</td><td style="text-align: right;">181</td><td style="text-align: right;">3750</td><td style="text-align: left;">male</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">2</td><td style="text-align: left;">Adelie</td><td style="text-align: left;">Torgersen</td><td style="text-align: right;">39.5</td><td style="text-align: right;">17.4</td><td style="text-align: right;">186</td><td style="text-align: right;">3800</td><td style="text-align: left;">female</td></tr><tr><td class="rowNumber" style="font-weight: bold; text-align: right;">3</td><td style="text-align: left;">Adelie</td><td style="text-align: left;">Torgersen</td><td style="text-align: right;">40.3</td><td style="text-align: right;">18.0</td><td style="text-align: right;">195</td><td style="text-align: right;">3250</td><td style="text-align: left;">female</td></tr></tbody></table></div>
</div>
</div>
<p>This data set has several correlated numeric variables on bill length, bill depth, flipper length, and body mass; and several categorical variables, such as species, island, and sex. An even more complete data set can be downloaded from the GitHub site.</p>
<section id="univariate-graphical-summaries" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="univariate-graphical-summaries"><span class="header-section-number">6.1</span> Univariate graphical summaries</h2>
<p>We run through the basic graphics for univariate statistics. We shall see that the framework makes multi-variate display quite direct, and at times easier than a univariate display.</p>
<section id="boxplot-and-violin-plot" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="boxplot-and-violin-plot"><span class="header-section-number">6.1.1</span> Boxplot and violin plot</h3>
<p>A boxplot (<a href="#fig-basic-boxplot-penguin">Figure&nbsp;<span>6.1</span></a>) for each species is created by composing a series of declarative commands:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">data</span>(penguins) <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visual</span>(BoxPlot) <span class="op">*</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="st">"Bill length (mm)"</span>, color<span class="op">=:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This illustrates many of the idioms used in the <code>AlgebraOfGraphics</code>.</p>
<p>The <code>data(penguins)</code> command sets up the data. Here a data frame is passed, but this can be any <code>Tables</code> compatible structure, such as a struct of arrays such as <code>data((;x, y))</code> for some pair of variables <code>x</code> and <code>y</code>.</p>
<p>The <code>mapping</code> call takes values in the data to positions and attributes of the graphic. It uses <em>position</em> to identify the <code>x</code>, <code>y</code>, and (at times) <code>z</code> values for the graphic. The <code>y</code> variable specification above illustrates a mini language nearly identical to the <code>DataFrames</code> mini language. For a box plot, an indicator of the groups goes in the <code>x</code> position, the data values in the <code>y</code> position. The <code>color=:species</code> argument uses a mapping between the levels of the <code>:species</code> variable and color ramp to give the graphic a distinct color for each species. Omitting this argument produces a monotone graphic with the chosen theme.</p>
<p>The <code>visual(BoxPlot)</code> command declares the visualization or transformation to be used to view the data. The <code>visual</code> function expects a <em>type</em> indicating the plot type to use and optional keyword argument. In this case <code>BoxPlot</code> is the type associated with the <code>Makie.boxplot</code> function. At times this type must be qualified, such as with <code>Text</code>, for annotations.</p>
<p>Both the <code>mapping</code> and <code>visual</code> calls can be used to set attributes:</p>
<ul>
<li><code>visual</code> is used to set attributes for each element independent of the data. For example, a box plot has the argument <code>orientation</code> which is not data dependent, so is adjusted within the <code>visual</code> call.</li>
<li><code>mapping</code> is used to have attributes depend on values of a variable, like <code>color</code> is used above.</li>
</ul>
<p>The attributes are those for the underlying plotting function. For <code>visual(BoxPlot)</code>, these can be seen at the help page for <code>boxplot</code>, displayed with the command <code>?boxplot</code>.</p>
<p>The <code>mapping</code> calls shows two uses of the mini language for data manipulation. The basic form is <code>source =&gt; function =&gt; target</code> and works very much like the DataFrames mini language does for <code>select</code> or <code>transform</code>, but unlike those, the function is <em>always</em> applied by row. This makes some transformations, such as <span class="math inline">\(z\)</span>-scores not possible within this call – transformations requiring the entire column need to be done within the values passed to <code>data</code>. The abbreviated forms are just <code>source</code>, as used with the <code>color=:species</code> argument; <code>source =&gt; function</code>; and <code>source =&gt; target</code>, such as <code>:bill_length_mm =&gt; "bill length (mm)"</code> used to rename the variable for labeling purposes. When the source involves more than one column selector, tuples should be used to group them. A few functions are provided to bypass the usual mapping of the data. (For example, <code>color</code> maps levels of a factor to a color ramp behind the scenes.) Among these are <code>nonnumeric</code> to pass a numeric variable to a value expecting a categorical variables and <code>verbatim</code> to avoid this mapping. The latter, <code>=&gt; verbatim</code>, will be necessary to add when annotating a figure.</p>
<p>The object <code>p</code> can be rendered to the screen with the <code>draw</code> method resulting in <a href="#fig-basic-boxplot-penguin">Figure&nbsp;<span>6.1</span></a>. Just <code>draw(p)</code> will render the graphic, the following also shows how the <code>figure</code> keyword argument can be used to set attributes using a named tuple, in this case the figure size. Similarly <code>axis</code> values can be modified in this manner. In the following, we set a title attribute for the axis.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(p; figure<span class="op">=</span>(;resolution<span class="op">=</span>(<span class="fl">600</span>,<span class="fl">400</span>)),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>     axis<span class="op">=</span>(; title<span class="op">=</span><span class="st">"Bill length"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div id="fig-basic-boxplot-penguin" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-basic-boxplot-penguin-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.1: Boxplots of bill length for the three penguin species in <code>penguins</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>This is the basic pattern where different choices are combined, or merged, with the <code>*</code> operation. The pieces can be re-purposed. In the following, we make use of this data:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">data</span>(penguins);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Box plots are very effective for quickly comparing distributions of a numeric variable across the levels of some factor. The calling syntax preferences that style, where both an <code>x</code> and <code>y</code> value are specified to <code>mapping</code>. To create a box plot of a <em>single</em> variable, without grouping, the graphic takes a bit more to construct. In the following we create a single valued <code>x</code> variable to produce the upper left graphic in <a href="#fig-layout-example">Figure&nbsp;<span>6.2</span></a>:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> d <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="fl">1</span> <span class="op">=&gt;</span> one, <span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="st">"Bill length (mm)"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The mini language is used above two different ways: with a function to create the single value for <code>x</code> (<code>AlgebraOfGraphics</code> will treat this to a factor, so <code>one</code> isn’t needed, just some single-valued function) <em>and</em> with a target for labeling the <code>y</code> variable. As mentioned, such transformation can also have be done within the data frame passed to <code>data</code>.</p>
<p>To add another layer, in this case a scatter plot, we can <em>add</em> the plotting objects:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p2a <span class="op">=</span> d <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p2b <span class="op">=</span> d <span class="op">*</span> <span class="fu">visual</span>(Scatter) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> p2a <span class="op">+</span> p2b;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>Scatter</code> transformation plots pairs of points in a Cartesian plane.</p>
<p>Combinations with <code>+</code> add a layer; those with <code>*</code> merge layers. The <em>algebra</em> name also refers to algebraically desirable short cuts. For example, we repeat <code>d</code> and the <code>mapping</code> for each <code>p2a</code> and <code>p2b</code>, but these can be used just once by <em>distributing</em> them:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="st">"bill length (mm)"</span>, color<span class="op">=:</span>species);</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span>  d <span class="op">*</span> ( <span class="fu">visual</span>(BoxPlot) <span class="op">+</span> <span class="fu">visual</span>(Scatter) ) <span class="op">*</span> m;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both <code>p2</code> and <code>p3</code> are shown in the lower row of <a href="#fig-layout-example">Figure&nbsp;<span>6.2</span></a>. There is just one slight difference, the dots representing the data in <code>p2</code> are not colored, as the mapping did not instruct that in forming <code>p2b</code>.</p>
<p>Specifying a violin plot requires just a slight modification to the above: we change the <code>BoxPlot</code> visual to <code>Violin</code>. Violin plots have an argument <code>side</code> that allows both sides of the violin to reflect an extra grouping variable. We use the <code>:sex</code> variable in the following, as it has only two levels. With this, each side of the violin plot reflects grouping by the <code>:sex</code> factor, the legend is used to lookup which level of the factor is represented.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> d <span class="op">*</span> <span class="fu">visual</span>(Violin) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species, side<span class="op">=:</span>sex);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>visual(Violin)</code> call wraps the function <code>Makie.violin</code> whose documentation contains additional possible arguments beyond <code>side</code>.</p>
<p>The <code>AlgebraOfGraphics</code> package builds on the <code>Makie</code> package and can use its layout system. Makie’s layout system leverages matrix notation to specify cell position. The <code>draw!</code> method accepts a figure object as a first argument. In <a href="#fig-layout-example">Figure&nbsp;<span>6.2</span></a> we layout 2 rows and 2 columns of figures, as follows:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">draw!</span>(f[<span class="fl">1</span>,<span class="fl">1</span>], p1)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">draw!</span>(f[<span class="fl">1</span>,<span class="fl">2</span>], p4)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">draw!</span>(f[<span class="fl">2</span>,<span class="fl">1</span>], p2)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">draw!</span>(f[<span class="fl">2</span>,<span class="fl">2</span>], p3)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div id="fig-layout-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-layout-example-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.2: Figure showing four different graphics displayed. In this case, a single boxplot; a violin plot; a boxplot with scatter; and a similar one with the data and mapping easily reused for each visual.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dot-plot" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="dot-plot"><span class="header-section-number">6.1.2</span> Dot plot</h3>
<p>The boxplot does an excellent job of summarizing a data set with a few indicators making it quite useful when there are many data points. A dot plot is useful when there are a limited number of values and advantageous as the graphic shows all the data.</p>
<p>A dot plot (<a href="#fig-dotplot-variations">Figure&nbsp;<span>6.3</span></a>) can be constructed easily enough by ensuring, in this case, the <code>y</code> variable is non-numeric:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>huddle <span class="op">=</span> penguins[<span class="fu">sample</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">size</span>(penguins,<span class="fl">1</span>), <span class="fl">50</span>),<span class="op">:</span>] <span class="co"># a sample</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="fu">data</span>(huddle) <span class="op">*</span> <span class="fu">visual</span>(Scatter) <span class="op">*</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm<span class="op">=&gt;</span><span class="st">"Bill length (mm)"</span>, <span class="op">:</span>species <span class="op">=&gt;</span> nonnumeric);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(In this example, <code>species</code> is categorical, so the extra <code>=&gt; nonnumeric</code> is unnecessary.)</p>
<p>Compare the above to a boxplot of the same sampled data:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="fu">data</span>(huddle) <span class="op">*</span> <span class="fu">visual</span>(BoxPlot) <span class="op">*</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>species, <span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="st">"Bill length (mm)"</span>; color<span class="op">=:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The boxplot makes it easy to compare medians across the levels of the <code>species</code> factor to gauge graphically if there is a differentiated effect on the response.</p>
<p>The following is an enhanced dot plot which emphasizes a comparison of center by adding a line and sorting so that this line only moves to the right as the eye travels up the levels of the factor. The code is a modification of some from <span class="citation" data-cites="Embrace-Uncertainty-Fitting-Mixed-Effects-Models-with-Julia">(<a href="../references.html#ref-Embrace-Uncertainty-Fitting-Mixed-Effects-Models-with-Julia" role="doc-biblioref">Alday et al. 2022</a>)</span>.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="st">"`dotplot`: show values for each group as dotplot sorted by some center"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">_arrange_dotplot_data</span>(df, value<span class="op">::</span><span class="dt">Symbol</span>, group<span class="op">::</span><span class="dt">Symbol</span>, center<span class="op">=</span>mean;</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                              jitter<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transform!</span>(df, value <span class="op">=&gt;</span> <span class="dt">Array</span>, group <span class="op">=&gt;</span> CategoricalArray;</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>               renamecols<span class="op">=</span><span class="cn">false</span>) <span class="co"># set up types</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    sumry <span class="op">=</span> <span class="fu">combine</span>(<span class="fu">groupby</span>(df, group), value <span class="op">=&gt;</span> center <span class="op">=&gt;</span> value)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sort!</span>(sumry, value)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    ordered_levels <span class="op">=</span> <span class="fu">string</span>.(sumry[!, group])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">levels!</span>(sumry[!, group], ordered_levels) <span class="co"># relevel, used in plotting</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">levels!</span>(df[!, group], ordered_levels)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    jitter <span class="op">&amp;&amp;</span> (df <span class="op">=</span> <span class="fu">combine</span>(<span class="fu">groupby</span>(df, group),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                            value <span class="op">=&gt;</span> (x <span class="op">-&gt;</span> x <span class="op">.+</span> <span class="fu">std</span>(x)<span class="op">/</span><span class="fl">100</span>), renamecols<span class="op">=</span><span class="cn">false</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    df, sumry</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>df, sumry <span class="op">=</span> <span class="fu">_arrange_dotplot_data</span>(huddle, <span class="op">:</span>bill_length_mm, <span class="op">:</span>species, median)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>mm <span class="op">=</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="st">"Bill length (mm)"</span>, <span class="op">:</span>species)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> <span class="fu">data</span>(df) <span class="op">*</span> mm <span class="op">*</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visual</span>(Scatter; marker<span class="op">=</span><span class="ch">'○'</span>, markersize<span class="op">=</span><span class="fl">12</span>)  <span class="co"># use a character for a marker</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">+=</span> <span class="fu">data</span>(sumry) <span class="op">*</span> mm <span class="op">*</span> <span class="fu">visual</span>(Lines);         <span class="co"># add summary line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All these figures appear in <a href="#fig-dotplot-variations">Figure&nbsp;<span>6.3</span></a>.</p>
<div class="cell" data-execution_count="15">
<div class="cell-output cell-output-display" data-execution_count="16">
<div id="fig-dotplot-variations" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-dotplot-variations-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.3: A basic dot plot, a comparable box plot, and an enhanced dot plot. For small data sets, the dot plot can show comparisons of spread and center quite well; reordering based on the center emphasizes the differentiated effect on the response of the grouping variable.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="faceting" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="faceting"><span class="header-section-number">6.1.3</span> Faceting</h3>
<p>The package also supports <em>faceting</em> where different panels share the same scales allowing easy cross comparison. Faceting is specified through the keyword <code>layout</code> or either (or both) of <code>row</code> and <code>col</code> keywords. The <code>layout</code> keyword uses levels of the variable name it is passed and arranges the plots over these levels. A <code>col</code> declaration will make columns for each level of the specified variable, whereas a <code>row</code> declaration will create rows for each level of the specified variables. By default both the <code>x</code> and <code>y</code> axes are <em>linked</em>. These linkings can be decoupled when <code>draw</code>ing by passing in values to the <code>facet</code> argument, along the lines of: <code>draw(p, facet=(; linkxaxes=:none, linkyaxes=:none))</code>.</p>
</section>
<section id="histograms" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="histograms"><span class="header-section-number">6.1.4</span> Histograms</h3>
<p>The <code>AlgebraOfGraphics</code> has certain functions it refers to as <em>transformations</em> of the data. These include <code>histogram</code>, <code>density</code>, <code>frequency</code>, <code>linear</code>, <code>smooth</code>, and <code>expectation</code>; most all will be illustrated by example below.</p>
<p>These are used like <code>visual</code> was above, but arguments are passed directly to the transformation.</p>
<p>The <code>histogram</code> function plays the role of <code>visual</code> in this graphic. (The <code>visual</code> function is still useful to apply data-independent attributes.) Here we arrange to color by <code>species</code>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> d <span class="op">*</span> <span class="fu">histogram</span>() <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The histograms overlap. The <code>layout</code> command can be used to declare one panel per level. We do this with <code>:sex</code>:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> d <span class="op">*</span> <span class="fu">histogram</span>() <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species, layout<span class="op">=:</span>sex);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See <a href="#fig-histogram-densityplot-example">Figure&nbsp;<span>6.4</span></a> for the graphics.</p>
</section>
<section id="density-plot" class="level3" data-number="6.1.5">
<h3 data-number="6.1.5" class="anchored" data-anchor-id="density-plot"><span class="header-section-number">6.1.5</span> Density plot</h3>
<p>The <code>histogram</code> function has options for overriding the default bin selection and has several options for scaling the figure through its <code>normalization</code> argument. We use this in the next graphic which layers a density plot over a scaled histogram using the <code>:pdf</code> scaling. The <code>density</code> transformation is qualified with the module name to prevent a conflict with one in <code>Makie</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>layers <span class="op">=</span> <span class="fu">histogram</span>(normalization<span class="op">=:</span>pdf) <span class="op">+</span> AlgebraOfGraphics.<span class="fu">density</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> d <span class="op">*</span> layers <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species, layout<span class="op">=:</span>sex);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this next figure we add in a scatter plot of the data on top of the density plots. For the scatter plot, we use the <code>Scatter</code> visual for which we create jittered <span class="math inline">\(y\)</span> values to disambiguate the data, these are added as a column to the data in <code>d1</code>, below:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>p4a <span class="op">=</span> d <span class="op">*</span>  AlgebraOfGraphics.<span class="fu">density</span>() <span class="op">*</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, color<span class="op">=:</span>species)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> <span class="fu">data</span>(<span class="fu">transform</span>(penguins,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                    <span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="fu">ByRow</span>(x <span class="op">-&gt;</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="fu">rand</span>()) <span class="op">=&gt;</span> <span class="op">:</span>ys))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>p4b <span class="op">=</span> d1 <span class="op">*</span> <span class="fu">visual</span>(Scatter) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, <span class="op">:</span>ys, color<span class="op">=:</span>species)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> p4a <span class="op">+</span> p4b;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="cell-output cell-output-display" data-execution_count="21">
<div id="fig-histogram-densityplot-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-histogram-densityplot-example-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.4: Histogram and Density plots.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="quantile-normal-plots" class="level3" data-number="6.1.6">
<h3 data-number="6.1.6" class="anchored" data-anchor-id="quantile-normal-plots"><span class="header-section-number">6.1.6</span> Quantile-normal plots</h3>
<p>The <code>QQNorm</code> and <code>QQPlot</code> visuals are used to make quantile-quantile plots; <code>QQNorm</code> expects a mapping to <code>:x</code> (first position) whereas <code>QQPlot</code> expects mappings to <code>:x</code> and <code>:y</code> (the first two positions).</p>
<p>The following will give a visual check if bill length is normally distributed, the graphic indicates slightly shorter tails than expected</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="fu">data</span>(penguins) <span class="op">*</span> <span class="fu">visual</span>(QQNorm, qqline<span class="op">=:</span>fit) <span class="op">*</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following will give a visual check if bill length has a similarly <em>shaped</em> distribution as bill depth, in this case with each species highlighted:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="fu">data</span>(penguins) <span class="op">*</span> <span class="fu">visual</span>(QQPlot, qqline<span class="op">=:</span>fit) <span class="op">*</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, <span class="op">:</span>bill_depth_mm, color<span class="op">=:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both are shown in <a href="#fig-quantileplot-example">Figure&nbsp;<span>6.5</span></a>.</p>
<div id="fig-quantileplot-example" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" data-execution_count="23" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output cell-output-display" data-execution_count="24">
<p><img src="makie_files/figure-html/cell-24-output-1.svg" class="img-fluid figure-img"></p>
</div>
</div>
<div class="cell quarto-layout-cell" data-execution_count="24" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output cell-output-display" data-execution_count="25">
<p><img src="makie_files/figure-html/cell-25-output-1.svg" class="img-fluid figure-img"></p>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.5: Quantile-quantile plots. The left graphic uses a reference normal distribution (through <code>QQNorm</code>), the right one uses <code>QQPlot</code> to compare the distribution of two variables after grouping by <code>species</code>.</figcaption><p></p>
</figure>
</div>
</section>
</section>
<section id="line-plots" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="line-plots"><span class="header-section-number">6.2</span> Line plots</h2>
<p>A scatter plot shows <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> pairs as points, a line plot connects these points. There are numerous ways to draw lines with the <code>AlgebraOfGraphics</code> including: <code>visual(Lines)</code>, for connect-the-dots lines; <code>visual(LinesFill)</code>, for shading; <code>visual(HLines)</code> and <code>visual(VLines)</code>, for horizontal and vertical lines; <code>visual(Rangebars)</code> to draw vertical or horizontal line segments.</p>
<p>The graph of a function can be drawn using <code>Lines</code>, as in this example, where we add in different range bars to emphasize the role that the two parameters play in this function’s graph:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ϕ</span>(x; μ<span class="op">=</span><span class="fl">0</span>, σ<span class="op">=</span><span class="fl">1</span>) <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu">sqrt</span>(<span class="fl">2</span><span class="op">*</span><span class="cn">pi</span><span class="op">*</span>σ<span class="op">^</span><span class="fl">2</span>) <span class="op">*</span> <span class="fu">exp</span>(<span class="fu">-</span>(<span class="fl">1</span><span class="op">/</span>(<span class="fl">2</span>σ)) <span class="op">*</span> (x <span class="op">-</span> μ)<span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> <span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length<span class="op">=</span><span class="fl">251</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ys <span class="op">=</span> <span class="fu">ϕ</span>.(xs)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fu">data</span>((x<span class="op">=</span>xs, y<span class="op">=</span>ys)) <span class="op">*</span> <span class="fu">visual</span>(Lines) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>x, <span class="op">:</span>y)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>c <span class="op">+=</span> <span class="fu">data</span>(<span class="fu">DataFrame</span>(x<span class="op">=</span><span class="fl">0</span>, hi<span class="op">=</span><span class="fu">ϕ</span>(<span class="fl">0</span>), lo<span class="op">=</span><span class="fl">0</span>)) <span class="op">*</span> <span class="fu">visual</span>(Rangebars) <span class="op">*</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>x, <span class="op">:</span>hi, <span class="op">:</span>lo)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>c <span class="op">+=</span> <span class="fu">data</span>(<span class="fu">DataFrame</span>(xmin<span class="op">=</span><span class="fl">0</span>, xmax<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fu">ϕ</span>(<span class="fl">1</span>))) <span class="op">*</span> <span class="fu">visual</span>(Rangebars, direction<span class="op">=:</span>x) <span class="op">*</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>y, <span class="op">:</span>xmin, <span class="op">:</span>xmax)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>c <span class="op">+=</span> <span class="fu">data</span>((x<span class="op">=</span>[<span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>], y<span class="op">=</span>[<span class="fl">0</span>, <span class="fu">ϕ</span>(<span class="fl">1</span>)], label<span class="op">=</span>[<span class="st">"μ"</span>, <span class="st">"σ"</span>])) <span class="op">*</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visual</span>(Makie.Text) <span class="op">*</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>x, <span class="op">:</span>y, text <span class="op">=</span> <span class="op">:</span>label <span class="op">=&gt;</span> verbatim)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<p><img src="makie_files/figure-html/cell-26-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The <code>Rangebars</code> visual has a <code>direction</code> argument, used above to make a horizontal range bar.</p>
<p>The annotation has two subtleties: the qualification of <code>Makie.Text</code> is needed, as there is a <code>Text</code> type in base <code>Julia</code>. More idiosyncratically, the use of <code>verbatim</code> in <code>mapping</code> is needed to avoid an attempt to map the labels to a glyph, such as a pre-defined marker.</p>
</section>
<section id="bivariate-relationships" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="bivariate-relationships"><span class="header-section-number">6.3</span> Bivariate relationships</h2>
<p>Scatterplots with trend lines are easily produced within the <code>AlgebraOfGraphics</code> framework: the <code>Scatter</code> visual creates scatter plots; for trend lines there is the <code>smooth</code> transformation to fit a loess line, and the <code>linear</code> transformation to fit linear models.</p>
<p>This first set of commands shows how to fit a smoother (upper left graphic in <a href="#fig-scatterplot-example">Figure&nbsp;<span>6.6</span></a>). The <code>smooth</code> function has arguments which pass on to <code>Loess.loess</code>.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>layers <span class="op">=</span> <span class="fu">visual</span>(Scatter) <span class="op">+</span> <span class="fu">smooth</span>()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> d <span class="op">*</span> layers <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, <span class="op">:</span>bill_depth_mm);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>linear</code> function draws the fitted regression line and shades an interval automatically (the <code>interval</code> argument). Linear prediction under model assumptions provides a means to identify confidence intervals for the <em>mean</em> response (the average value were the covariates held fixed and the response repeatedly samples) and for the <em>predicted</em> response for a single observation. The latter are wider, as single observations have more variability than averages of observations. A value of <code>nothing</code> suppresses this aspect.</p>
<p>This next set of commands shows (upper-right figure of <a href="#fig-scatterplot-example">Figure&nbsp;<span>6.6</span></a>) one way to add a linear regression line. As the mapping for <code>linear</code> does not include the grouping variable, (<code>color</code>) the line is based on all the data:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> d <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm, <span class="op">:</span>bill_depth_mm)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>p2a <span class="op">=</span> d1 <span class="op">*</span> <span class="fu">visual</span>(Scatter) <span class="op">*</span> <span class="fu">mapping</span>(color<span class="op">=:</span>species)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>p2b <span class="op">=</span> d1 <span class="op">*</span> <span class="fu">linear</span>()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> p2a <span class="op">+</span> p2b;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Whereas with this next specification, <code>color</code> is mapped for both the <code>linear</code> transformation and the <code>Scatter</code> visual. This groups the data and separate lines are fit to each. We can see (lower-left figure of <a href="#fig-scatterplot-example">Figure&nbsp;<span>6.6</span></a>) that whereas the entire data shows a negative correlation, the cohorts are all positively correlated, an example of <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s paradox</a>.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>layers <span class="op">=</span> <span class="fu">visual</span>(Scatter) <span class="op">+</span> <span class="fu">linear</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> d1 <span class="op">*</span> layers <span class="op">*</span>  <span class="fu">mapping</span>(color<span class="op">=:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding <code>layout=:sex</code> shows more clearly (lower-right figure of <a href="#fig-scatterplot-example">Figure&nbsp;<span>6.6</span></a>) that each group has a regression line fit, that is the multiplicative model is fit.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> d1 <span class="op">*</span> layers <span class="op">*</span>  <span class="fu">mapping</span>(color<span class="op">=:</span>species, layout<span class="op">=:</span>sex);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="cell-output cell-output-display" data-execution_count="31">
<div id="fig-scatterplot-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-scatterplot-example-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.6: Scatter plots of bill depth by bill width produced by varying specifications.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="corner-plot" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="corner-plot"><span class="header-section-number">6.3.1</span> Corner plot</h3>
<p>A corner plot, as produced by the <code>PairPlots</code> package through its <code>pairplot</code> function, is a quick plot to show pair-wise relations amongst multiple numeric values. The graphic uses the lower part of a grid to show paired scatterplots with, by default, contour lines highlighting the relationship. On the diagonal are univariate density plots.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PairPlots</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>nms <span class="op">=</span> <span class="fu">names</span>(penguins, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">select</span>(penguins, nms <span class="op">.=&gt;</span> <span class="fu">replace</span>.(nms, <span class="st">"_mm"</span> <span class="op">=&gt;</span> <span class="st">""</span>, <span class="st">"_"</span> <span class="op">=&gt;</span> <span class="st">" "</span>)) <span class="co"># adjust names</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pairplot</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<p><img src="makie_files/figure-html/cell-32-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="d-scatterplots" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="d-scatterplots"><span class="header-section-number">6.3.2</span> 3D scatterplots</h3>
<p>A 3-d scatter plot of 3 numeric variables can be readily arranged, with just one unexpected trick:</p>
<ul>
<li><p>The <code>mapping</code> object should contain an <code>x</code>, <code>y</code>, <em>and</em> <code>z</code> variable specification with numeric variables.</p></li>
<li><p>The <code>draw</code> call should include an <code>axis = (type = Axis3,)</code> call, specifying that a 3D (<code>Makie</code>) axis should be used in the display.</p></li>
</ul>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">data</span>(penguins)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> d <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>bill_length_mm <span class="op">=&gt;</span> <span class="op">:</span>bl,  <span class="op">:</span>bill_depth_mm <span class="op">=&gt;</span> <span class="op">:</span>bd,  <span class="op">:</span>flipper_length_mm<span class="op">=&gt;:</span>fl; color<span class="op">=:</span>species,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>              row<span class="op">=:</span>sex, col<span class="op">=:</span>island)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(p, axis<span class="op">=</span>((<span class="kw">type</span><span class="op">=</span>Axis3,)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div id="fig-3d-scatterplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-3d-scatterplot-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.7: 3D scatter plots of bill length, bill depth, and flipper length with faceting by island and sex variables.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="categorical-data" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="categorical-data"><span class="header-section-number">6.4</span> Categorical data</h2>
<p>The distribution of the surveyed species is not the same. A bar chart can illustrate (upper-left graphic of <a href="#fig-barplot-example">Figure&nbsp;<span>6.8</span></a>). The <code>frequency</code> transform does the counting:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> d <span class="op">*</span> <span class="fu">frequency</span>() <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>species);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two categories can be illustrated, we need <code>dodge</code> set here to avoid overplotting of the bars. In this example, following the <code>AlgebraOfGraphics</code> tutorial, we add in information about the island. This shows (upper-right graphic of <a href="#fig-barplot-example">Figure&nbsp;<span>6.8</span></a>) that two species are found on just 1 island, whereas Adelie is found on all three.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> d <span class="op">*</span> <span class="fu">frequency</span>() <span class="op">*</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>species, color<span class="op">=:</span>island, dodge<span class="op">=:</span>island);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>stack</code> in place of <code>dodge</code> presents a stacked bar chart (lower-left graphic of <a href="#fig-barplot-example">Figure&nbsp;<span>6.8</span></a>):</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> d <span class="op">*</span> <span class="fu">frequency</span>() <span class="op">*</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>species, color<span class="op">=:</span>island, stack<span class="op">=:</span>island);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A third category can be introduced using <code>layout</code>, <code>col</code>, or <code>row</code> (lower-right graphic of <a href="#fig-barplot-example">Figure&nbsp;<span>6.8</span></a>):</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> d <span class="op">*</span> <span class="fu">frequency</span>() <span class="op">*</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(<span class="op">:</span>species, color<span class="op">=:</span>island, stack<span class="op">=:</span>island) <span class="op">*</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mapping</span>(row<span class="op">=:</span>sex);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="37">
<div class="cell-output cell-output-display" data-execution_count="38">
<div id="fig-barplot-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="makie_files/figure-html/fig-barplot-example-output-1.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.8: Scatter plots of bill depth by bill width produced by varying specifications.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="customizing-plots-through-axis" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="customizing-plots-through-axis"><span class="header-section-number">6.5</span> Customizing plots through <code>axis</code></h2>
<p>There are a numerous customizations available when drawing a plot. We discuss a small handful of them here. See the <a href="https://tutorials.pumas.ai/html/PlottingInJulia/04-AoG-Custom.html">PumasAI</a> tutorial and the documentation for more details.</p>
<p>The <code>draw</code> command allows the passing of values to the <code>axis</code> mechanism of <code>Makie</code>. This allows customization of various features such as the title, the ticks, the aspect ration, and the grids.</p>
<p><code>Makie</code> plots are themeable. In the above we used <code>set_aog_theme!()</code>. This theme sets a number of defaults for the axis attributes:</p>
<pre><code>Axis = (
        xgridvisible=false,
        ygridvisible=false,
        topspinevisible=false,
        rightspinevisible=false,
        bottomspinecolor=:darkgray,
        leftspinecolor=:darkgray,
        xtickcolor=:darkgray,
        ytickcolor=:darkgray,
        xticklabelfont=lightfont,
        yticklabelfont=lightfont,
        xlabelfont=mediumfont,
        ylabelfont=mediumfont,
        titlefont=mediumfont,
    )</code></pre>
<p>To override these or pass other attributes on to the rendering, the <code>axis</code> keyword argument accepts a named tuple of values. So, for example, to set the graphics title, we would see <code>axis=(; title="Some title")</code>, to instruct the labels in a barplot on the <code>x</code> axis to be rotated, we would see <code>axis=(;xticklabelrotation = pi/2)</code>. Of course these would typically combined, as above.</p>
<p>The following lists some useful attributes. A complete list is in the <a href="https://docs.makie.org/dev/api/#Axis">Makie</a> docs for the <code>Axis</code> constructor.</p>
<p>The aspect ratio for a graphic is adjustable through the <code>aspect</code> attribute XX</p>
<p>The following labeling attributes can be adjusted: <code>title</code>, <code>subtitle</code>, <code>xlabel</code>, <code>ylabel</code>. These take a string (or an observable) for the value to display. This value can be adjusted, for example, there are <code>titlealign</code>, <code>titlecolor</code>, <code>titlefont</code>, <code>titlesize</code>, and <code>titlevisible</code> attributes. Similar attributes exist for the other labels.</p>
<p>An axis has ticks. These are often numbers. For the ticks on an <code>x</code> axis there are attributes <code>xticks</code>, <code>xtickcolor</code>, <code>xtickformat</code>, <code>xticksize</code>, and <code>xtickwidth</code>. Similarly with <code>y</code>. There are also minor ticks, adjustable with, for example, <code>xminorticks</code>, <code>xminortickcolor</code>, <code>xminorticksize</code>, etc.</p>
<p>For ticks representing categorical values, labels are used. Attributes for tick labels include: <code>xticklabelalign</code>, <code>xticklabelcolor</code>, <code>xticklabelfont</code>, <code>xticklabelrotation</code>, and <code>xticklabelsize</code>.</p>
<p>The displayed grid is adjustable through attributes like <code>xgridcolor</code>, <code>xgridstyle</code>, <code>xgridvisible</code>, <code>xgridwidth</code>, along with “<code>minor</code>” versions.</p>
<p>For 3 dimension plots, the <code>Axis3</code> object is used for display. This has similarly named attributes for <code>z</code> values.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Embrace-Uncertainty-Fitting-Mixed-Effects-Models-with-Julia" class="csl-entry" role="doc-biblioentry">
Alday, P., Kliegl, R., and Bates, D. (2022), <em>Embrace uncertainty: Fitting mixed-effects models with julia</em>, https://juliamixedmodels.github.io/EmbraceUncertainty/.
</div>
<div id="ref-DanischKrumbiegel2021" class="csl-entry" role="doc-biblioentry">
Danisch, S., and Krumbiegel, J. (2021), <span>“Makie.jl: Flexible high-performance data visualization for julia,”</span> <em>Journal of Open Source Software</em>, The Open Journal, 6, 3349. <a href="https://doi.org/10.21105/joss.03349">https://doi.org/10.21105/joss.03349</a>.
</div>
<div id="ref-AoG" class="csl-entry" role="doc-biblioentry">
Vertechi, P., and others (n.d.). <em><a href="https://github.com/MakieOrg/AlgebraOfGraphics.jl">AlgebraOfGraphics.jl</a></em>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The <code>Makie</code> density function could be accessed through <code>visual(Density)</code> without module qualification. The <code>density</code> function in <code>AlgebraOfGraphics</code> has a nice transparency feature which makes its use desirable.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../EDA/categorical-data-julia.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Inference/distributions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability distributions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-right">© Copyright 2023, John Verzani. All rights reserved.</div>
  </div>
</footer>



</body></html>