<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using Julia for Introductory Statistics - 9&nbsp; The linear regression model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references.html" rel="next">
<link href="../Inference/inference.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KS515LKBGZ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-KS515LKBGZ', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../LinearModels/linear-regression.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The linear regression model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Using Julia for Introductory Statistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jverzani/UsingJ" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/univariate-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Univariate data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/tabular-data-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tabular data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/bivariate-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bivariate data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/categorical-data-julia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../EDA/makie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The <code>AlgebraOfGraphics</code> package</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Inference/inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../LinearModels/linear-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The linear regression model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link active" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">9.1</span> Multiple linear regression</a>
  <ul class="collapse">
  <li><a href="#generic-methods-for-statistical-models" id="toc-generic-methods-for-statistical-models" class="nav-link" data-scroll-target="#generic-methods-for-statistical-models"><span class="header-section-number">9.1.1</span> Generic methods for statistical models</a></li>
  </ul></li>
  <li><a href="#categorical-covariates" id="toc-categorical-covariates" class="nav-link" data-scroll-target="#categorical-covariates"><span class="header-section-number">9.2</span> Categorical covariates</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">9.3</span> Interactions</a></li>
  <li><a href="#f-test" id="toc-f-test" class="nav-link" data-scroll-target="#f-test"><span class="header-section-number">9.4</span> F test</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jverzani/UsingJ/edit/master/LinearModels/linear-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jverzani/UsingJ/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The linear regression model</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We discuss the linear regression model in the following using linear algebra to quickly formulate the main results. For those unfamiliar with linear algebra, its use is only to illustrate various aspects that have pre-defined methods in <code>GLM</code>; no user-level linear algebra is necessary for computation.</p>
<p>For this, we utilize the following packages:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span>, <span class="bu">Distributions</span>, <span class="bu">GLM</span>, <span class="bu">HypothesisTests</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span>, <span class="bu">DataFrames</span>, <span class="bu">CategoricalArrays</span>, <span class="bu">RDatasets</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span>, <span class="bu">AlgebraOfGraphics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="multiple-linear-regression" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="multiple-linear-regression"><span class="header-section-number">9.1</span> Multiple linear regression</h2>
<p>The simple linear regression model related a covariate variable, <span class="math inline">\(x\)</span>, to a response variable <span class="math inline">\(Y\)</span> through a formulation:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 \cdot x_i + e_i,
\]</span></p>
<p>where <span class="math inline">\(\beta_0, \beta_1\)</span> are the parameters for the model that describe the average value of the <span class="math inline">\(Y\)</span> variable for a given <span class="math inline">\(x\)</span> value and the random errors, <span class="math inline">\(e_i\)</span>, are <em>assumed</em> to be described to be a random sample from some distribution, usually <span class="math inline">\(Normal(0, \sigma)\)</span>. Some inferential results require this sample to be iid.</p>
<p>The model for multiple regression is similar, though there are <span class="math inline">\(k = 0, 1\)</span>, or more covariates accounted for in the notation:</p>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 \cdot x_{1i} + \beta_2 \cdot x_{2i} + \cdots + \beta_k \cdot x_{ki} + e_i.
\]</span></p>
<p>Following <span class="citation" data-cites="WackerlyMendenhallSchaeffer">(<a href="../references.html#ref-WackerlyMendenhallSchaeffer" role="doc-biblioref">Wackerly et al. 2008</a>)</span> we formulate the regression model using matrix algebra and quickly review their main results.</p>
<p>If there are <span class="math inline">\(n\)</span> groups of data, then the main model matrix is the <span class="math inline">\(n\times (k+1)\)</span> matrix:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><span class="math display">\[
X =
\begin{bmatrix}
1      &amp; x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1k}\\
1      &amp; x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2k}\\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
1 &amp; x_{n1} &amp; x_{n2} &amp; \cdots &amp; x_{nk}
\end{bmatrix}.
\]</span></p>
<p>The response, parameters, and errors are recorded in column vectors:</p>
<p><span class="math display">\[
Y = [y_1, y_2, \cdots, y_n], \quad \beta = [\beta_0, \beta_1, \dots, \beta_k], \quad e= [e_1, e_2, \dots, e_n].
\]</span></p>
<p>The collection of equations can then be written as <span class="math inline">\(Y = X\beta + e\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>The notation <span class="math inline">\(\hat{Y} = X\beta\)</span> is common, as the values <span class="math inline">\(X\beta\)</span> are used to <em>predict</em> the average values of the response. The least squares problem to estimate the parameters is then to find <span class="math inline">\(\beta\)</span> that minimizes:</p>
<p><span class="math display">\[
\lVert Y - \hat{Y} \rVert^2 = \lVert Y - X\beta \rVert^2.
\]</span></p>
<p>Using calculus, it can be seen that any minimizer, <span class="math inline">\(\hat{\beta}\)</span>, will satisfy <span class="math inline">\(X'X\hat{\beta}=X'Y\)</span>, with <span class="math inline">\(X'\)</span> denoting the transpose<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. When written out these are called the <em>normal equations</em>, which, <em>when</em> the matrix <span class="math inline">\(X\)</span> is non-degenerate (rank <span class="math inline">\(k+1\)</span> in this case) can be solved algebraically by</p>
<p><span class="math display">\[
\hat{\beta} = (X'X)^{-1}X' Y.
\]</span></p>
<p>We now assume the errors are an iid random sample from a distribution with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2\)</span>. The matrix of covariances, <span class="math inline">\(COV(\beta_i, \beta_j)\)</span>, is called the covariance matrix and denoted <span class="math inline">\(\Sigma_{\hat{\beta}\hat{\beta}}\)</span>. Under these assumptions, it can be shown to satisfy:</p>
<p><span class="math display">\[
\Sigma_{\hat{\beta}\hat{\beta}} = \sigma^2 (X'X)^{-1}.
\]</span></p>
<p>The parameter <span class="math inline">\(\sigma^2\)</span> can be estimated. We have the <em>residuals</em> are given in vector form by <span class="math inline">\(\hat{e} = Y - \hat{Y}\)</span>. Here <span class="math inline">\(\hat{Y} = \hat{H}Y\)</span>. The product <span class="math inline">\(\hat{H} = X(X'X)^{-1}X'\)</span> is called the “hat” matrix and comes from <span class="math inline">\(\hat{Y} = X\hat{\beta} = X((X'X)^{-1}X'Y) = (X(X'X)^{-1}X')Y\)</span>.</p>
<p>The hat matrix has the property of a <em>projection matrix</em> taking values in an <span class="math inline">\(n\)</span> dimensional space and projecting onto a subspace described by the columns of the <span class="math inline">\(X\)</span> matrix. This allows a geometric interpretation of the least-squares formulation.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>The sum of squared residuals is:</p>
<p><span class="math display">\[
\sum (Y_i - \hat{Y_i})^2 = \lVert Y - \hat{Y} \rVert^2 = \lVert (1-\hat{H})Y\rVert^2 = Y'(I-\hat{H})Y,
\]</span></p>
<p>where <span class="math inline">\(I\)</span> is the diagonal matrix of all ones that acts like an identity under multiplication.</p>
<p>The expected value can be computed to get <span class="math inline">\(E(\lVert Y - \hat{Y} \rVert^2) = (n - 1 - k)\sigma^2\)</span>, which is used to <em>estimate</em> <span class="math inline">\(\sigma^2\)</span>:</p>
<p><span class="math display">\[
s^2 = \frac{\lVert Y - \hat{Y} \rVert^2}{n-1-k} = \frac{\sum (Y_i - \hat{Y_i})^2}{n-1-k}.
\]</span></p>
<p>(When <span class="math inline">\(k=0\)</span>, this is the same as the sample standard deviation with <span class="math inline">\(\hat{Y_i}\)</span> simply <span class="math inline">\(\bar{Y}\)</span>.)</p>
<p>More is known of the <span class="math inline">\(\hat{\beta}\)</span>, in particular the distribution of:</p>
<p><span class="math display">\[
\frac{(\hat{\beta}-\beta) \cdot (X'X) \cdot (\hat{\beta} - \beta)}{\sigma^2},
\]</span></p>
<p>is <span class="math inline">\(Chisq(k+1)\)</span> and, if the errors are from an iid random sample with population <span class="math inline">\(Normal(0, \sigma)\)</span>, is independent of <span class="math inline">\(s^2\)</span>. In which case, the ratio is <span class="math inline">\(F\)</span> distributed, leading to the following: a <span class="math inline">\((1-\alpha)\cdot 100\)</span>% <em>joint</em> confidence interval for <span class="math inline">\(\beta\)</span> is found with:</p>
<p><span class="math display">\[
(\hat{\beta}-\beta) \cdot (X'X) \cdot (\hat{\beta}-\beta) \leq (1+k)s^2 F_{1-\alpha; 1 + k, n-1-k}.
\]</span></p>
<p>While the error terms, <span class="math inline">\(e\)</span>, are assumed to be <em>independent</em>, the residuals, <span class="math inline">\(\hat{e}\)</span>, are not so, as one large residual must be offset by other smaller ones due to the minimization of the squared residuals. The matrix of their covariances can be expressed as <span class="math inline">\(\Sigma_{\hat{e}\hat{e}} = \sigma^2 (I-\hat{H})\)</span>. The <em>standardized</em> residuals account for the <span class="math inline">\((I-\hat{H})\)</span> and are given by: <span class="math inline">\(e_i/(s\sqrt{1 - \hat{H}_{ii}})\)</span>.</p>
<p>When the errors are an iid sample then the fitted values, <span class="math inline">\(\hat{Y}\)</span>, are uncorrelated with the residuals.</p>
<p>If it is assumed the error population is normal, then the least-square estimates for <span class="math inline">\(\beta\)</span>, given by <span class="math inline">\(\hat{\beta} = (X'X)^{-1}X Y\)</span>, are linear combinations of <em>independent</em> normal random variables, and consequently are normally distributed. (This is assuming the covariates are not random, or the <span class="math inline">\(Y\)</span> values are conditionally independent.) For each <span class="math inline">\(i\)</span>, we have <span class="math inline">\(E(\hat{\beta}_i) = \beta_i\)</span> and <span class="math inline">\(SE(\hat{\beta}_i) = s_{\hat{\beta}_i} = s \sqrt{c_{ii}}\)</span>, where <span class="math inline">\(c_{ii}\)</span> is the diagonal entry of <span class="math inline">\((X'X)^{-1}\)</span>. Moreover, the <span class="math inline">\(T\)</span>-statistic:</p>
<p><span class="math display">\[
T = \frac{\hat{\beta}_i - \beta_i}{SE(\hat{\beta}_{ii})},
\]</span></p>
<p>will have a <span class="math inline">\(T\)</span>-distribution with <span class="math inline">\(n-k-1\)</span> degrees of freedom, when the errors are iid and normally distributed. For a single estimate, <span class="math inline">\(\hat{\beta}_i \pm t_{1 - \alpha/2, n-1-k} s \sqrt{((X'X)^{-1})_{ii}}\)</span> forms a <span class="math inline">\((1 - \alpha)\cdot 100\)</span>% confidence interval for <span class="math inline">\(\beta_i\)</span>.</p>
<p>When the regression model is used for predicting the mean response for a given set of covariates, <span class="math inline">\(x_0\)</span>, the predictor would be <span class="math inline">\(\hat{\mu}_0 = x_0 \cdot \hat{\beta}\)</span> (with the first value for <span class="math inline">\(x_0\)</span> being <span class="math inline">\(1\)</span>). The variance can be computed to give <span class="math inline">\(VAR(\hat{\mu}_0) = \sigma^2 x_0'(X'X)^{-1}x_0\)</span>, which depends on the value of <span class="math inline">\(x_0\)</span>. Confidence bands drawn by the <code>linear()</code> visualization for a scatterplot of data use this formula and a related one to estimate a single value, not an average value. The dependence on <span class="math inline">\(x_0\)</span> gives the curve away from the center, <span class="math inline">\(\bar{x}\)</span>.</p>
<p>A measure of how much variation in the response is explained by the dependence on the respective covariates (the <em>coefficient of determination</em>) is given by <span class="math inline">\(R^2\)</span> which is computed by</p>
<p><span class="math display">\[
R^2 = 1 - \frac{SSR}{SST},
\]</span></p>
<p>where <span class="math inline">\(SSR = \sum \hat{e}_i^2 = \sum (y_i - \hat{y}_i)^2\)</span> is the sum of the squared residuals and <span class="math inline">\(SST = \sum (y_i - \bar{y})^2\)</span> is the total sum of the squares. When the ratio <span class="math inline">\(SSR/SST\)</span> is close to <span class="math inline">\(1\)</span>, then the model (<span class="math inline">\(\hat{y}\)</span>) doesn’t explain much of the variation compared to the null model with all the <span class="math inline">\(\beta_i\)</span>’s, <span class="math inline">\(i \geq 1\)</span> being <span class="math inline">\(0\)</span> and the sample mean of the <span class="math inline">\(y\)</span>, <span class="math inline">\(\bar{y}\)</span>, used for prediction. Conversely, when the ratio is close to <span class="math inline">\(0\)</span>, then the model explains much of the variation. By subtracting this from <span class="math inline">\(1\)</span>, as is customary, we have the interpretation that <span class="math inline">\(R^2\)</span> explains <span class="math inline">\(R^2 \cdot 100\)</span>% of the variation in the <span class="math inline">\(y\)</span> values.</p>
<p>The value of <span class="math inline">\(R^2\)</span> can be made equal to <span class="math inline">\(1\)</span> with enough variables; the <em>adjusted</em> <span class="math inline">\(R^2\)</span> value is a modification that weights <span class="math inline">\(SSR/SST\)</span> by <span class="math inline">\((n-1)/(n-k-1)\)</span> so using more variables (bigger <span class="math inline">\(k\)</span>) is penalized.</p>
<section id="generic-methods-for-statistical-models" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="generic-methods-for-statistical-models"><span class="header-section-number">9.1.1</span> Generic methods for statistical models</h3>
<p>The <code>StatsBase</code> package defines methods for the above calculations and more. These are generic methods with similar usage for other models than the linear regression model discussed here. <a href="#tbl-stat-models-api" class="quarto-xref">Table&nbsp;<span>9.1</span></a> lists several.</p>
<div id="tbl-stat-models-api" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stat-models-api-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9.1: Generic methods for statistical models defined in <a href="https://juliastats.org/StatsBase.jl/stable/statmodels/"><code>StatsBase</code></a>. Those marked with a <span class="math inline">\(*\)</span> are defined on the <code>model</code> property of the <code>lm</code> output.
</figcaption>
<div aria-describedby="tbl-stat-models-api-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>coef</code></td>
<td>Least squares estimates for <span class="math inline">\(\hat{\beta}_0, \hat{\beta}_1, \dots, \hat{\beta}_k\)</span></td>
</tr>
<tr class="even">
<td><code>coefnames</code></td>
<td>Names of coefficients</td>
</tr>
<tr class="odd">
<td><code>stderror</code></td>
<td>Standard errors of coefficients</td>
</tr>
<tr class="even">
<td><code>residuals</code></td>
<td>Residuals, <span class="math inline">\(y_i - \hat{y}_i\)</span></td>
</tr>
<tr class="odd">
<td><code>fitted</code></td>
<td><span class="math inline">\(\hat{y}_i\)</span> values</td>
</tr>
<tr class="even">
<td><code>predict</code></td>
<td>Predict future values using <span class="math inline">\(\hat{\beta}\)</span>s</td>
</tr>
<tr class="odd">
<td><code>confint</code></td>
<td>Confindence interval for estimated parameters</td>
</tr>
<tr class="even">
<td><code>modelmatrix</code></td>
<td>Matrix (<span class="math inline">\(X\)</span>) used in computations</td>
</tr>
<tr class="odd">
<td><code>nobs</code></td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td><code>dof</code></td>
<td><em>Consumed</em> degrees of freedom (matrix rank plus <span class="math inline">\(1\)</span>)</td>
</tr>
<tr class="odd">
<td><code>dof_residual</code></td>
<td>residual degrees of freedom. <span class="math inline">\(n-k-1\)</span></td>
</tr>
<tr class="even">
<td><code>r2</code></td>
<td>Coefficient of determination, <span class="math inline">\(1 - SSR/SST\)</span></td>
</tr>
<tr class="odd">
<td><code>adjr2</code></td>
<td>Adjusted <span class="math inline">\(R^2\)</span>, <span class="math inline">\(1 - SSR/SST \cdot (n-1)/(n-1-k)\)</span></td>
</tr>
<tr class="even">
<td><code>vcov</code></td>
<td>Variance/Covariance matrix for the <span class="math inline">\(\hat{\beta}\)</span>s</td>
</tr>
<tr class="odd">
<td><code>deviance</code></td>
<td>Residual sum of squares, <span class="math inline">\(SSR\)</span></td>
</tr>
<tr class="even">
<td><code>dispersion</code><span class="math inline">\(^*\)</span></td>
<td>Estimate for <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\hat{\sigma} = \sqrt{SSR/(n-1-k)}\)</span> or <code>dispersion(res)/dof_residual(res)</code></td>
</tr>
<tr class="odd">
<td><code>nulldeviance</code></td>
<td>Total sum of squares <span class="math inline">\(SST = \sum(y_i - \bar{y})^2\)</span>.</td>
</tr>
<tr class="even">
<td><code>loglikelihood</code></td>
<td>Log-likelihood of the model</td>
</tr>
<tr class="odd">
<td><code>nullloglikelihood</code></td>
<td>Log-likelihood of null model</td>
</tr>
<tr class="even">
<td><code>ftest</code><span class="math inline">\(^*\)</span></td>
<td>Compute <span class="math inline">\(F\)</span>-test of two or more <em>nested</em> models</td>
</tr>
<tr class="odd">
<td><code>aic</code></td>
<td>Akaike’s Information Criterion, <span class="math inline">\(-2\log(L) + 2(k+2)\)</span></td>
</tr>
<tr class="even">
<td><code>bic</code></td>
<td>Bayesian Information Criterion, <span class="math inline">\(-2\log(L) + (k+2)\log(n)\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="exm-simple-linear-regression" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.1 (Example of simple linear regression)</strong></span> Consider some fabricated data on dosage amount of Ivermectin and days to recovery of COVID-19 fit by a simple linear model:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">6</span>, <span class="fl">6</span>];</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(y <span class="op">~</span> x), (; x, y))  <span class="co"># uses named tuple to specify data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

y ~ 1 + x

Coefficients:
────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error     t  Pr(&gt;|t|)    Lower 95%   Upper 95%
────────────────────────────────────────────────────────────────────────────
(Intercept)  4.94886     0.744004    6.65    0.0006   3.12835     6.76938
x            0.00193182  0.00176594  1.09    0.3159  -0.00238928  0.00625292
────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The output shows the estimated coefficients, <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>. These are computed by <span class="math inline">\((X'X)^{-1}XY\)</span>:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> <span class="fu">modelmatrix</span>(res)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inv</span>(X<span class="op">'</span> <span class="op">*</span> X) <span class="op">*</span> X<span class="op">'</span> <span class="op">*</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>2-element Vector{Float64}:
 4.948863636363637
 0.0019318181818181804</code></pre>
</div>
</div>
<p>These are also returned by the <code>coef</code> method, as in <code>coef(res)</code>.</p>
<p>The default output also computes confidence intervals and performs two-sided tests of whether the parameter is <span class="math inline">\(0\)</span>. Focusing on <span class="math inline">\(\hat{\beta}_1\)</span>, we can find its standard error from <span class="math inline">\(s \sqrt{c_{ii}}\)</span>. First we compute <span class="math inline">\(s\)</span>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> <span class="fu">length</span>(x), <span class="fl">1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>s² <span class="op">=</span> <span class="fu">sum</span>(eᵢ<span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> eᵢ <span class="kw">in</span> <span class="fu">residuals</span>(res)) <span class="op">/</span> (n <span class="op">-</span> k <span class="op">-</span> <span class="fl">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="fu">sqrt</span>(s²)  <span class="co"># also dispersion(res.model)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">inv</span>(X<span class="op">'*</span>X)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sbetas <span class="op">=</span> s <span class="op">*</span> <span class="fu">sqrt</span>.(<span class="fu">diag</span>(C))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>2-element Vector{Float64}:
 0.7440036635973516
 0.0017659398031727332</code></pre>
</div>
</div>
<p>More conveniently, these are returned by the <code>stederror</code> method:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stderror</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>2-element Vector{Float64}:
 0.7440036635973516
 0.0017659398031727338</code></pre>
</div>
</div>
<p>These are also the square root of the diagonal of the covariance matrix, <span class="math inline">\(\Sigma_{\hat{\beta}\hat{\beta}}\)</span>, computed by the <code>vcov</code> method:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Σᵦᵦ <span class="op">=</span> <span class="fu">vcov</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>2×2 Matrix{Float64}:
  0.553541    -0.00109149
 -0.00109149   3.11854e-6</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>.(<span class="fu">diag</span>(Σᵦᵦ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>2-element Vector{Float64}:
 0.7440036635973516
 0.0017659398031727338</code></pre>
</div>
</div>
<p>The <span class="math inline">\(T\)</span>-statistic for <span class="math inline">\(H_0: \beta_1 = 0\)</span> is then</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>β̂₁ <span class="op">=</span> <span class="fu">coef</span>(res)[<span class="fl">2</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>SE₁ <span class="op">=</span> <span class="fu">stderror</span>(res)[<span class="fl">2</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>T_obs <span class="op">=</span> (β̂₁ <span class="op">-</span> <span class="fl">0</span>) <span class="op">/</span> SE₁</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>1.0939320685492355</code></pre>
</div>
</div>
<p>The <span class="math inline">\(p\)</span>-value is then found directly with:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span> <span class="op">*</span> <span class="fu">ccdf</span>(<span class="fu">TDist</span>(n<span class="op">-</span>k<span class="op">-</span><span class="fl">1</span>), T_obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0.315945937293384</code></pre>
</div>
</div>
<p>This computation is needed were there different assumed values than <span class="math inline">\(\beta_1 = 0\)</span> for the null, though this particular <span class="math inline">\(p\)</span>-value is included in the default display of <code>res</code>.</p>
<p>The confidence intervals are of the form <span class="math inline">\(\hat{\beta}_i \pm t_{1-\alpha/2; n-k-1} \cdot SE(\hat{\beta}_i)\)</span>. We find one for the intercept term, <span class="math inline">\(\beta_0\)</span>:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ta <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">TDist</span>(n<span class="op">-</span>k<span class="op">-</span><span class="fl">1</span>), <span class="fl">1</span> <span class="op">-</span> alpha<span class="op">/</span><span class="fl">2</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>β̂₀ <span class="op">=</span> <span class="fu">coef</span>(res)[<span class="fl">1</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>SE₀ <span class="op">=</span> <span class="fu">stderror</span>(res)[<span class="fl">1</span>]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>β̂₀ <span class="op">.+</span> ta <span class="op">*</span> [<span class="op">-</span>SE₀, SE₀]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>2-element Vector{Float64}:
 3.128352254612003
 6.769375018115272</code></pre>
</div>
</div>
<p>The <code>confint</code> method will also compute these, returning the values as rows in a matrix:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>2×2 Matrix{Float64}:
  3.12835     6.76938
 -0.00238928  0.00625292</code></pre>
</div>
</div>
<p>We compute the confidence interval for <span class="math inline">\(\hat{\mu}\)</span> when <span class="math inline">\(x=500\)</span> using the variance formula above.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">500</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>μ̂ <span class="op">=</span> <span class="fu">predict</span>(res, (x<span class="op">=</span>[<span class="fl">500</span>],))[<span class="fl">1</span>]  <span class="co"># also  dot(inv(X'*X)*X'*y, x0)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>SE <span class="op">=</span> s <span class="op">*</span> <span class="fu">sqrt</span>(x0<span class="op">'</span> <span class="op">*</span> <span class="fu">inv</span>(X<span class="op">'</span> <span class="op">*</span> X) <span class="op">*</span> x0)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> μ̂ <span class="op">.+</span> ta <span class="op">*</span> [<span class="op">-</span>SE, SE]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>2-element Vector{Float64}:
 4.711829667120805
 7.117715787424649</code></pre>
</div>
</div>
<p>We can visualize (<a href="#fig-linear-regression-confidicence-interval" class="quarto-xref">Figure&nbsp;<span>9.1</span></a>) with the following commands:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>layers <span class="op">=</span> (<span class="fu">visual</span>(Scatter) <span class="op">+</span> <span class="fu">linear</span>(; interval<span class="op">=:</span>confidence))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fu">data</span>((;x, y)) <span class="op">*</span> layers <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>x, <span class="op">:</span>y)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">+=</span> <span class="fu">data</span>((x<span class="op">=</span>[<span class="fl">500</span>, <span class="fl">500</span>], y<span class="op">=</span>ci)) <span class="op">*</span> <span class="fu">visual</span>(Lines) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>x, <span class="op">:</span>y)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div id="fig-linear-regression-confidicence-interval" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-linear-regression-confidicence-interval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="linear-regression_files/figure-html/fig-linear-regression-confidicence-interval-output-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-linear-regression-confidicence-interval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.1: Illlustration of linear regression model with confidence band drawn. The vertical line is computed directly for the value of <span class="math inline">\(x=500\)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The value of <span class="math inline">\(R^2\)</span> can be computed directly:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">-</span> <span class="fu">sum</span>(eᵢ<span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> eᵢ <span class="kw">in</span> <span class="fu">residuals</span>(res)) <span class="op">/</span> <span class="fu">sum</span>((yᵢ <span class="op">-</span> <span class="fu">mean</span>(y))<span class="op">^</span><span class="fl">2</span> <span class="cf">for</span> yᵢ <span class="kw">in</span> y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0.166283084004603</code></pre>
</div>
</div>
<p>This can also be computed using several of the methods defined for model outputs by <code>GLM</code>:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(res), <span class="fl">1</span> <span class="op">-</span> <span class="fu">deviance</span>(res)<span class="op">/</span><span class="fu">nulldeviance</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>(0.166283084004603, 0.166283084004603)</code></pre>
</div>
</div>
<p>Whichever way, for this model a low <span class="math inline">\(R^2\)</span> implies the model does not explain much of the variance in the response.</p>
</div>
<div id="exm-multiple-regression" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.2 (Multiple regression example)</strong></span> We give an example of multiple linear regression using a data set on various cereal boxes in a US grocery store.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"MASS"</span>, <span class="st">"UScereal"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(cereal, <span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div><div style="float: left;"><span>2×12 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Brand</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MFR</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Calories</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Protein</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Fat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sodium</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Fibre</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Carbo</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sugars</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Shelf</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Potassium</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Vitamins</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="CategoricalValue{String, UInt8}">Cat…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int32">Int32</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="CategoricalValue{String, UInt8}">Cat…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">100% Bran</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">212.121</td>
<td style="text-align: right;">12.1212</td>
<td style="text-align: right;">3.0303</td>
<td style="text-align: right;">393.939</td>
<td style="text-align: right;">30.303</td>
<td style="text-align: right;">15.1515</td>
<td style="text-align: right;">18.1818</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">848.485</td>
<td style="text-align: left;">enriched</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">All-Bran</td>
<td style="text-align: left;">K</td>
<td style="text-align: right;">212.121</td>
<td style="text-align: right;">12.1212</td>
<td style="text-align: right;">3.0303</td>
<td style="text-align: right;">787.879</td>
<td style="text-align: right;">27.2727</td>
<td style="text-align: right;">21.2121</td>
<td style="text-align: right;">15.1515</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">969.697</td>
<td style="text-align: left;">enriched</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The data set collected numerous variables, here we consider numeric ones:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cereal, <span class="dt">Real</span>) <span class="op">|&gt;</span> permutedims</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>1×9 Matrix{String}:
 "Calories"  "Protein"  "Fat"  "Sodium"  …  "Sugars"  "Shelf"  "Potassium"</code></pre>
</div>
</div>
<p>The initial model we consider has <code>Calories</code> as a response, and several covariates:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fm <span class="op">=</span> <span class="pp">@formula</span>(Calories <span class="op">~</span> Protein <span class="op">+</span> Fat <span class="op">+</span> Sodium <span class="op">+</span> Carbo <span class="op">+</span> Sugars)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(fm, cereal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Calories ~ 1 + Protein + Fat + Sodium + Carbo + Sugars

Coefficients:
────────────────────────────────────────────────────────────────────────────────
                    Coef.  Std. Error      t  Pr(&gt;|t|)    Lower 95%    Upper 95%
────────────────────────────────────────────────────────────────────────────────
(Intercept)  -18.9515       3.61524    -5.24    &lt;1e-05  -26.1856     -11.7175
Protein        3.99092      0.598282    6.67    &lt;1e-08    2.79376      5.18808
Fat            8.86319      0.803833   11.03    &lt;1e-15    7.25472     10.4717
Sodium         0.00266192   0.0107093   0.25    0.8046   -0.0187674    0.0240913
Carbo          4.91706      0.162811   30.20    &lt;1e-36    4.59128      5.24284
Sugars         4.20214      0.216049   19.45    &lt;1e-26    3.76983      4.63446
────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The output shows what might have been anticipated: there appears to be no connection between <code>Sodium</code> and <code>Calories</code>, though were this data on dinner foods that might not be the case. The <span class="math inline">\(T\)</span>-test displayed for <code>Sodium</code> is a test of whether the slope based on <code>Sodium</code> is <span class="math inline">\(0\)</span> – holding the other variables constant – and the large <span class="math inline">\(p\)</span>-value would lead us to accept that hypotheses.</p>
<p>We drop this variable from the model and refit:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Calories <span class="op">~</span> Protein <span class="op">+</span> Fat <span class="op">+</span> Carbo <span class="op">+</span> Sugars), cereal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Calories ~ 1 + Protein + Fat + Carbo + Sugars

Coefficients:
─────────────────────────────────────────────────────────────────────────
                 Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
─────────────────────────────────────────────────────────────────────────
(Intercept)  -18.7698     3.51272   -5.34    &lt;1e-05  -25.7963   -11.7433
Protein        4.05056    0.543752   7.45    &lt;1e-09    2.9629     5.13823
Fat            8.85889    0.797339  11.11    &lt;1e-15    7.26398   10.4538
Carbo          4.92466    0.158656  31.04    &lt;1e-37    4.6073     5.24202
Sugars         4.21069    0.211619  19.90    &lt;1e-27    3.78739    4.634
─────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>How to interpret this? Each coefficient (save the intercept) measures the <em>predicted</em> change in <em>mean</em> number of calories for a <span class="math inline">\(1\)</span>-unit increase <em>holding</em> the other variables fixed. For example, it is suggested that adding 1 additional unit of protein holding the other variables constant would add nearly 4 calories per serving, on average.</p>
</div>
<div id="exm-polynomial-regression" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.3 (Polynomial regression)</strong></span> <a href="http://jse.amstat.org/v3n1/datasets.dickey.html">Dickey</a> provides an analysis of Galileo’s falling ball data. Galileo rolled a ball down an elevated ramp at certain distances, the ball then jumped down a certain distance that varied depending on the height of the ramp. The collected data is:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>release <span class="op">=</span> [<span class="fl">1000</span>, <span class="fl">800</span>, <span class="fl">600</span>, <span class="fl">450</span>, <span class="fl">300</span>, <span class="fl">200</span>, <span class="fl">100</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>horizontal_distance <span class="op">=</span> [<span class="fl">573</span>, <span class="fl">534</span>, <span class="fl">495</span>, <span class="fl">451</span>, <span class="fl">395</span>, <span class="fl">337</span>, <span class="fl">253</span>]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>galileo <span class="op">=</span> <span class="fu">DataFrame</span>(; release, horizontal_distance)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(galileo, <span class="fl">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div><div style="float: left;"><span>3×2 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">release</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">horizontal_distance</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">573</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">800</td>
<td style="text-align: right;">534</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">495</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>With an assumption that the horizontal distance was related to <span class="math inline">\(v_xt\)</span> and <span class="math inline">\(t\)</span> was found by solving for <span class="math inline">\(0 = h - (1/2)gt^2\)</span>, we might expect <span class="math inline">\(h\)</span> and <span class="math inline">\(t\)</span> to be quadratically related. We consider, somewhat artifcially, the release height modeled <em>linearly</em> by the horizontal distance:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(y <span class="op">~</span> x), (y<span class="op">=</span>galileo.release, x<span class="op">=</span>galileo.horizontal_distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

y ~ 1 + x

Coefficients:
─────────────────────────────────────────────────────────────────────────────
                  Coef.  Std. Error      t  Pr(&gt;|t|)    Lower 95%   Upper 95%
─────────────────────────────────────────────────────────────────────────────
(Intercept)  -713.262    156.449     -4.56    0.0061  -1115.43     -311.098
x               2.77908    0.350392   7.93    0.0005      1.87837     3.67979
─────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>Without much effort, the small <span class="math inline">\(p\)</span>-value would lead one to conclude the linear term is statistically significant. But Galileo might have expected a <em>quadratic</em> relationship and a modern reader might, as well, viewing <a href="#fig-galileo-linear" class="quarto-xref">Figure&nbsp;<span>9.2</span></a>, such as modeled by the following:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>res₂ <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(y <span class="op">~</span> x <span class="op">+</span> x<span class="op">^</span><span class="fl">2</span>), (y<span class="op">=</span>galileo.release, x<span class="op">=</span>galileo.horizontal_distance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

y ~ 1 + x + :(x ^ 2)

Coefficients:
────────────────────────────────────────────────────────────────────────────────────
                    Coef.     Std. Error      t  Pr(&gt;|t|)     Lower 95%    Upper 95%
────────────────────────────────────────────────────────────────────────────────────
(Intercept)  600.054       110.543         5.43    0.0056  293.136       906.971
x             -4.00484       0.55582      -7.21    0.0020   -5.54805      -2.46164
x ^ 2          0.00818074    0.000665952  12.28    0.0003    0.00633176    0.0100297
────────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The rules of <code>@formula</code> parse the above as adding a variable <code>x^2</code> to the model. Alternatively, the data frame could have been transformed to produce that variable. The output shows the test of <span class="math inline">\(\beta_2=0\)</span> would be rejected for reasonable values of <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell" data-execution_count="23">
<div class="cell-output cell-output-display" data-execution_count="24">
<div id="fig-galileo-linear" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-galileo-linear-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="linear-regression_files/figure-html/fig-galileo-linear-output-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galileo-linear-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.2: Scatter plot of falling-ball data of Galileo with a linear model fit. The curve suggests a quadratic model.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="categorical-covariates" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="categorical-covariates"><span class="header-section-number">9.2</span> Categorical covariates</h2>
<p>The linear regression model is more flexible than may appear on first introduction through simple regression.</p>
<p>For example, the regression model when there are no covariates is just a one-sample <span class="math inline">\(T\)</span>-test, as seen from this example where a two-sided test of <span class="math inline">\(0\)</span> mean is carried out.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> [<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.9</span>, <span class="fl">2.7</span>, <span class="fl">2.6</span>, <span class="fl">1.5</span>, <span class="fl">0.6</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="pp">@formula</span>(y <span class="op">~</span> <span class="fl">1</span>), (;y)) <span class="co"># using a named tuple for the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

y ~ 1

Coefficients:
──────────────────────────────────────────────────────────────────────
               Coef.  Std. Error     t  Pr(&gt;|t|)  Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────
(Intercept)  1.51667    0.465773  3.26    0.0225   0.319359    2.71397
──────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The formula usually has an <em>implicit</em> intercept, but here with no covariates listed, it must be made explicit. Compare the values with the following:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OneSampleTTest</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>One sample t-test
-----------------
Population details:
    parameter of interest:   Mean
    value under h_0:         0
    point estimate:          1.51667
    95% confidence interval: (0.3194, 2.714)

Test summary:
    outcome with 95% confidence: reject h_0
    two-sided p-value:           0.0225

Details:
    number of observations:   6
    t-statistic:              3.2562360146885347
    degrees of freedom:       5
    empirical standard error: 0.46577295374940403</code></pre>
</div>
</div>
<p>Further, the two-sample <span class="math inline">\(T\)</span>-test (with equal variances assumed) can be performed through the regression model. After tidying the data, we fit a model:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> [<span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">DataFrame</span>(group<span class="op">=</span>[<span class="st">"g1"</span>, <span class="st">"g2"</span>], value<span class="op">=</span>[y1, y2])</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="fu">flatten</span>(df, [<span class="op">:</span>value])</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(value <span class="op">~</span> group), d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

value ~ 1 + group

Coefficients:
───────────────────────────────────────────────────────────────────────
                Coef.  Std. Error     t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────
(Intercept)  5.5         0.58757   9.36    &lt;1e-05    4.17083    6.82917
group: g2    0.214286    0.736558  0.29    0.7777   -1.45192    1.88049
───────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>We can compare the computed values to those computed a different way:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EqualVarianceTTest</span>(y2, y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>Two sample t-test (equal variance)
----------------------------------
Population details:
    parameter of interest:   Mean difference
    value under h_0:         0
    point estimate:          0.214286
    95% confidence interval: (-1.452, 1.88)

Test summary:
    outcome with 95% confidence: fail to reject h_0
    two-sided p-value:           0.7777

Details:
    number of observations:   [7,4]
    t-statistic:              0.2909286827258563
    degrees of freedom:       9
    empirical standard error: 0.7365575380122867</code></pre>
</div>
</div>
<p>However, some comments are warranted. We would have found a slightly different answer (a different sign) had we done <code>EqualVarianceTTest(y1, y2)</code>. This is because a choice is made if we consider <span class="math inline">\(\bar{y}_1-\bar{y}_2\)</span> or <span class="math inline">\(\bar{y}_2 - \bar{y}_1\)</span> in the statistic.</p>
<p>In the use of the linear model, there is a new subtlety – the <code>group</code> variable is <em>categorical</em> and not numeric. A peek at the <em>model matrix</em> (<code>modelmatrix(res)</code>) will show that the categorical variable was <em>coded</em> with a <span class="math inline">\(0\)</span> for each <code>g1</code> and <span class="math inline">\(1\)</span> for each <code>g2</code>. The details are handled by the underlying <code>StatsModels</code> package which first creates a <code>ModelFrame</code> which takes a formula and the data; <code>ModelMatrix</code> then creates the matrix, <span class="math inline">\(X\)</span>. The call to <code>ModelFrame</code> allows a specification of <em>contrasts</em>. The above uses the <code>DummyCoding</code>, which picks a base level (<code>"g1"</code> in this case) and then creates a variable for <em>each</em> other level, these variables having values either being <code>0</code> or <code>1</code>, and <code>1</code> only when the factor has that level. Using the notation <span class="math inline">\(1_{j}(x_i)\)</span> for this, we have the above call to <code>lm</code> fits the model <span class="math inline">\(y_i = \beta_0 + \beta_1 \cdot 1_{\text{g2}}(x_i) + e_i\)</span> and the model matrix shows this (2nd row below):</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelmatrix</span>(res) <span class="op">|&gt;</span> permutedims <span class="co"># turned on side to save page space</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>2×11 Matrix{Float64}:
 1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0
 0.0  0.0  0.0  0.0  1.0  1.0  1.0  1.0  1.0  1.0  1.0</code></pre>
</div>
</div>
<p>The model can’t be <span class="math inline">\(y_i = \beta_0 + \beta_1 \cdot 1_{\text{g2}}(x_i) + \beta_2 \cdot 1_{\text{g1}}(x_i) + e_i\)</span>, as there wouldn’t be a unique solution (the model <span class="math inline">\(y_i = (\beta_0 + \beta_2) + \beta_2\cdot 1_{\text{g2}}(x_i)\)</span> would also fit, so the parameters would not be identifiable). More mathematically, the model matrix, <span class="math inline">\(X\)</span>, would have 3 columns, but one of them could be expressed as a sum of the other 2. This would mean <span class="math inline">\(X\)</span> would not have full rank and the least-squares formula wouldn’t have the form it does.</p>
<p>To fit a model with different contrasts, the <code>lm</code> function has a <code>contrast</code> keyword argument.</p>
<p>The above formulation does not require the factor to have just 2 levels; if there are <span class="math inline">\(k\)</span> levels, then <span class="math inline">\(k-1\)</span> variables are formed in the model.</p>
<div id="exm-regression-with-categorical-variables" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.4 (Categorical covariates example)</strong></span> Consider the <code>cereal</code> data set. The <code>Shelf</code> variable is numeric, but really it should be considered categorical for any study using a linear model, as differences between shelf 1 and 2 and shelf 2 and 3 should not be expected to be uniform (as they would were the values treated numerically). The following first ensures <code>shelf</code> is categorical, then fits a model on how the shelf placement impacts the number of calories:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cereal.shelf <span class="op">=</span> <span class="fu">categorical</span>(cereal.Shelf)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Calories <span class="op">~</span> shelf), cereal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Calories ~ 1 + shelf

Coefficients:
───────────────────────────────────────────────────────────────────────
                Coef.  Std. Error     t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────
(Intercept)  119.477      13.3488  8.95    &lt;1e-12    92.7936   146.161
shelf: 2      10.3388     18.878   0.55    0.5859   -27.3979    48.0754
shelf: 3      60.6692     16.9939  3.57    0.0007    26.6989    94.6394
───────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The <span class="math inline">\(p\)</span>-value for shelf 2 is consistent with there being no difference between shelf 1 and 2, but that of shelf 3 (counting from the floor) is significantly different from shelf 1 and would be interpreted as having 60 additional calories over shelf 1. (Which fits the expectation that the lowest-shelf traditionally holds the least sold cereals, hence the most healthy in 1993 when this data was collected).</p>
<p>We can check that the model matrix has <span class="math inline">\(2\)</span> variables a few ways: directly from the size (with first column being the intercept), and indirectly by the residual degrees of freedom:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">size</span>(<span class="fu">modelmatrix</span>(res)), <span class="fu">nobs</span>(res) <span class="op">-</span> <span class="fu">dof_residual</span>(res) <span class="op">-</span> <span class="fl">1</span> <span class="co"># dof_residual = n - k - 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>((65, 3), 2.0)</code></pre>
</div>
</div>
<p>The omnibus <span class="math inline">\(F\)</span>-test is a statistical test for a null hypothesis that <span class="math inline">\(\beta_i=0\)</span> for all <span class="math inline">\(i\)</span> except <span class="math inline">\(i=0\)</span>. It is implemented in the <code>ftest</code> method of <code>GLM</code>. It requires fitting the null model of just a constant, which we do with:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>res₀ <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Calories <span class="op">~</span> <span class="fl">1</span>), cereal)  <span class="co"># null model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Calories ~ 1

Coefficients:
───────────────────────────────────────────────────────────────────────
               Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────
(Intercept)  149.408     7.74124  19.30    &lt;1e-27    133.943    164.873
───────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The test takes the model, which is stored in the <code>model</code> property:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftest</span>(res.model, res₀.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>F-test: 2 models fitted on 65 observations
────────────────────────────────────────────────────────────────────────
     DOF  ΔDOF          SSR        ΔSSR      R²      ΔR²      F*   p(&gt;F)
────────────────────────────────────────────────────────────────────────
[1]    4        198860.3072              0.2023                         
[2]    2    -2  249295.4943  50435.1871  0.0000  -0.2023  7.8623  0.0009
────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>Ignoring for now all but the bottom right number which gives the <span class="math inline">\(p\)</span>-value, we see that this null model would be rejected.</p>
</div>
</section>
<section id="interactions" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="interactions"><span class="header-section-number">9.3</span> Interactions</h2>
<p>An <em>interaction</em> is when the effect of one explanatory variable depends on the values of a different explanatory variable. We see such a case in the following example.</p>
<div id="exm-regression-interactions" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.5</strong></span> The <code>ToothGrowth</code> data set is included in base R and summarizes an experiment on the effect of vitamin C on tooth growth in guinea pigs. Each of the 60 animals in the study received one of three dose levels of vitamin C (0.5, 1, and 2 mg/day) by one of two delivery methods, orange juice or ascorbic acid. We load the data set using <code>RDatasets</code>:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ToothGrowth <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"ToothGrowth"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(ToothGrowth, <span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div><div style="float: left;"><span>2×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Len</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Supp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Dose</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="CategoricalValue{String, UInt8}">Cat…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: left;">VC</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">11.5</td>
<td style="text-align: left;">VC</td>
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><code>Dose</code> is seen to be stored as a numeric variable (<code>Float64</code>), but we treat it as a categorical variable in the following. The table shows that the 6 different treatment pairs were tested on 10 animals.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ToothGrowth.Dose <span class="op">=</span> <span class="fu">categorical</span>(ToothGrowth.Dose)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">combine</span>(<span class="fu">groupby</span>(ToothGrowth, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>), nrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div><div style="float: left;"><span>6×3 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Supp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Dose</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">nrow</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="CategoricalValue{String, UInt8}">Cat…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="CategoricalValue{Float64, UInt32}">Cat…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">OJ</td>
<td style="text-align: left;">0.5</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">OJ</td>
<td style="text-align: left;">1.0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">OJ</td>
<td style="text-align: left;">2.0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">VC</td>
<td style="text-align: left;">0.5</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">VC</td>
<td style="text-align: left;">1.0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">6</td>
<td style="text-align: left;">VC</td>
<td style="text-align: left;">2.0</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><a href="#fig-tooth-growth-violinplot" class="quarto-xref">Figure&nbsp;<span>9.3</span></a> shows a violinplot with sides reflecting the distribution of the <code>:Supp</code> variable. A quick glance suggests that there may be some effect due to the dosage amount and a difference between the <code>OJ</code> and <code>VC</code> delivery.</p>
<div class="cell" data-execution_count="35">
<div class="cell-output cell-output-display" data-execution_count="36">
<div id="fig-tooth-growth-violinplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tooth-growth-violinplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="linear-regression_files/figure-html/fig-tooth-growth-violinplot-output-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tooth-growth-violinplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9.3: ToothGrowth data set
</figcaption>
</figure>
</div>
</div>
</div>
<p>We proceed to fit the <em>additive</em> model where <code>Supp</code> introduces one variable, and <code>Dose</code> two:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Len <span class="op">~</span> Supp <span class="op">+</span> Dose), ToothGrowth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Len ~ 1 + Supp + Dose

Coefficients:
──────────────────────────────────────────────────────────────────────
              Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────
(Intercept)  12.455     0.98828  12.60    &lt;1e-17   10.4752    14.4348
Supp: VC     -3.7       0.98828  -3.74    0.0004   -5.67976   -1.72024
Dose: 1.0     9.13      1.21039   7.54    &lt;1e-09    6.7053    11.5547
Dose: 2.0    15.495     1.21039  12.80    &lt;1e-17   13.0703    17.9197
──────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The small <span class="math inline">\(p\)</span>-values support the visual observation that there are differences. The value for “<code>Supp: VC</code>”, for instance, indicates that holding the dose equal, administering the dosage through citamin C and not ascorbic acid had a negative effect of <span class="math inline">\(-3.7\)</span> units on the predicted average tooth length.</p>
<p>Visually, the distribution of the <code>VC</code> variable seems to depend on the dosage. Perhaps there is an <em>interaction</em>.</p>
<p>For this data we can fit a model</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; = \beta_0 + \\
    &amp; \beta_1 \cdot 1_{\text{VC}}(\text{Supp}_i) + \\
    &amp; \beta_2 \cdot 1_{1.0}(\text{Dose}_i) + \beta_3 \cdot 1_{2.0}(\text{Dose}_i) + \\
    &amp; \beta_4 \cdot 1_{\text{VC}, 1.0}(\text{Supp}_i, \text{Dose}_i) + \beta_5 \cdot 1_{\text{VC}, 2.0}(\text{Supp}_i, \text{Dose}_i) + e_i
\end{align*}\]</span></p>
<p>The additional terms account for cases where, say, <code>Supp = VC</code> <em>and</em> <code>Dose = 1.0</code>.</p>
<p>Interactions are specified in the modeling formula through <code>*</code>. (Which when used also includes the additive terms without interactions. Plain interactions are specified with <code>&amp;</code>.). The model is:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>resᵢ <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Len <span class="op">~</span> Supp <span class="op">*</span> Dose), ToothGrowth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

Len ~ 1 + Supp + Dose + Supp &amp; Dose

Coefficients:
──────────────────────────────────────────────────────────────────────────────
                      Coef.  Std. Error      t  Pr(&gt;|t|)  Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────────────
(Intercept)           13.23     1.14835  11.52    &lt;1e-15  10.9277     15.5323
Supp: VC              -5.25     1.62402  -3.23    0.0021  -8.50596    -1.99404
Dose: 1.0              9.47     1.62402   5.83    &lt;1e-06   6.21404    12.726
Dose: 2.0             12.83     1.62402   7.90    &lt;1e-09   9.57404    16.086
Supp: VC &amp; Dose: 1.0  -0.68     2.29671  -0.30    0.7683  -5.28462     3.92462
Supp: VC &amp; Dose: 2.0   5.33     2.29671   2.32    0.0241   0.725381    9.93462
──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>As expected from the graph, the <span class="math inline">\(p\)</span>-value for the “<code>Supp: VC &amp; Dose: 2.0</code>” case is significant.</p>
<p>As before, an <span class="math inline">\(F\)</span> test can test the difference between the model with and without the interaction:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftest</span>(res.model, resᵢ.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>F-test: 2 models fitted on 60 observations
───────────────────────────────────────────────────────────────────
     DOF  ΔDOF       SSR       ΔSSR      R²     ΔR²      F*   p(&gt;F)
───────────────────────────────────────────────────────────────────
[1]    5        820.4250             0.7623                        
[2]    7     2  712.1060  -108.3190  0.7937  0.0314  4.1070  0.0219
───────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The small <span class="math inline">\(p\)</span>-value suggests the interaction is statistically significant.</p>
</div>
</section>
<section id="f-test" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="f-test"><span class="header-section-number">9.4</span> F test</h2>
<p>Consider the linear regression model with parameters <span class="math inline">\(\beta\)</span> and a significance test with some constraint on the parameters (e.g.&nbsp;<span class="math inline">\(\beta_1 = 0\)</span> or <span class="math inline">\(\beta_1 = \beta_2\)</span>). Suppose the error terms are an iid random sample from a <span class="math inline">\(Normal(0, \sigma)\)</span> distribution. The a test of <span class="math inline">\(H_0\)</span> against an alternative of not <span class="math inline">\(H_0\)</span> can be carried out by considering the likelihood ratio statistic. The likelihood function for a set of parameters <span class="math inline">\(\beta\)</span> is:</p>
<p><span class="math display">\[\begin{align*}
L(\beta, \sigma, x) &amp;= \prod_{i=1}^n \frac{1}{(2\pi\sigma^2)^{n/2}} e^{-\frac{1}{2\sigma^2}(y_i - \hat{y}_i)^2}
\\
&amp;=\frac{1}{(2\pi)^{n/2}} \frac{1}{\sigma^n} e^{-\frac{1}{2\sigma^2}\sum_i(y_i - \hat{y}_i)^2},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\hat{y}_i = X\beta\)</span> for some <span class="math inline">\(X\)</span> related to the data. As <span class="math inline">\(e^{-x}\)</span> is decreasing, <span class="math inline">\(L\)</span> is maximized in <span class="math inline">\(\beta\)</span> when <span class="math inline">\(\sum_i (y_i - \hat{y}_i)^2\)</span> is <em>minimimized</em> (a least squares estimate), say at <span class="math inline">\(m(\hat{\beta})\)</span>. In terms of <span class="math inline">\(\sigma\)</span> we take a logarithm and seek to maximize:</p>
<p><span class="math display">\[
-\frac{n}{\sigma}\ln(2\pi)  - n \ln(\sigma) - \frac{1}{2\sigma^2} m(\hat{\beta}).
\]</span></p>
<p>This occurs at</p>
<p><span class="math display">\[
\hat{\sigma^2} = \frac{m(\hat{\beta})}{n} = \frac{1}{n} SSR,
\]</span></p>
<p>where <span class="math inline">\(SSR\)</span> indicates the sum of the squared residuals, <span class="math inline">\(y_i - \hat{y}_i\)</span>. (This is a <em>biased</em> estimate, as the divisor does not account for the degrees of freedom.)</p>
<p>The log-likelihood ratio statistic considers the two models: the restricted one under <span class="math inline">\(H_0\)</span> and the unrestricted one. This simplifies to</p>
<p><span class="math display">\[
\lambda = -2 \ln \frac{L_0}{L} = n \ln(\frac{SSR_0}{SSR}),
\]</span></p>
<p>with <span class="math inline">\(SSR_0\)</span> being the sum of the squared residuals under <span class="math inline">\(H_0\)</span> and <span class="math inline">\(SSR\)</span> the sum of the squared residuals under the full model, which necessarily is smaller than <span class="math inline">\(SSR_0\)</span>. The <em>asymptotic</em> distribution is <span class="math inline">\(Chisq(k-p)\)</span> where <span class="math inline">\(p\)</span> variables are free in <span class="math inline">\(H_0\)</span>.</p>
<p>The above says <em>if</em> <span class="math inline">\(SSR_0/SSR\)</span> is sufficiently large it is statistically significant. Algebraically, the same thing can be said about</p>
<p><span class="math display">\[
F = \frac{n-k-1}{k-p} \cdot \frac{SSR_0 - SSR}{SSR} =
\frac{(SSR_0 - SSR)/(k-p)}{SSR/(n-k-1)}.
\]</span></p>
<p>The distribution of <span class="math inline">\(SSR/(n-k-1)\)</span> is <span class="math inline">\(Chisq(n-k-1)\)</span>. However, under these assumptions and under the null hypothesis, by Cochran’s theorem <span class="math inline">\(SSR_0- SSR\)</span> is <em>independent</em> of <span class="math inline">\(SSR\)</span> and <span class="math inline">\((SSR_0-SSR)/(k-p)\)</span> is <span class="math inline">\(Chisq(k-p)\)</span>. That is <span class="math inline">\(F\)</span> has a <span class="math inline">\(FDist(n-k-1, k-p)\)</span> distribution. (Not asymptotically.)</p>
<p>This statistic is used by <code>ftest</code> to compare two <em>nested</em> models. Nested means the parameters in the reduced model are related to those in the full model; no new ones are introduced.</p>
<div id="exm-vc-continued" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.6</strong></span> Consider again the output of the last call to <code>ftest</code> which checked for an interaction between the <code>Supp</code> and <code>Dose</code> variables in the <code>ToothGrowth</code> data:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>res₀ <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Len <span class="op">~</span> Supp <span class="op">+</span> Dose), ToothGrowth)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>res  <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Len <span class="op">~</span> Supp <span class="op">*</span> Dose), ToothGrowth)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ftest</span>(res₀.model, res.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>F-test: 2 models fitted on 60 observations
───────────────────────────────────────────────────────────────────
     DOF  ΔDOF       SSR       ΔSSR      R²     ΔR²      F*   p(&gt;F)
───────────────────────────────────────────────────────────────────
[1]    5        820.4250             0.7623                        
[2]    7     2  712.1060  -108.3190  0.7937  0.0314  4.1070  0.0219
───────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The <em>null</em> hypothesis is <span class="math inline">\(H_0: \beta_4 = \beta_5 = 0\)</span>. The full model has <span class="math inline">\(k=5\)</span>, the null has <span class="math inline">\(p=3\)</span>. The reported degrees of freedom is the <em>consumed degrees of freedom</em> which is this number of (linearly independent) columns in the model matrix (<span class="math inline">\(k+1\)</span>) plus <span class="math inline">\(1\)</span>. The sum of squares can be computed directly or through the <code>deviance</code> method:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>SSR₀, SSR <span class="op">=</span> <span class="fu">deviance</span>(res₀), <span class="fu">deviance</span>(res) <span class="co"># or, say, sum(residuals(res₀).^2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>(820.4250000000001, 712.1059999999999)</code></pre>
</div>
</div>
<p>The difference between the two is the numerator of the <span class="math inline">\(F\)</span> statistic when divided by <span class="math inline">\(2 = 5-3\)</span> (or <span class="math inline">\(7-5\)</span>). The denominator should be <span class="math inline">\(SSR/(n-k-1)\)</span>:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>((SSR₀ <span class="op">-</span> SSR)<span class="op">/</span>(<span class="fl">5</span> <span class="op">-</span> <span class="fl">3</span>)) <span class="op">/</span> (SSR <span class="op">/</span> (<span class="fl">60</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>4.1069910940225265</code></pre>
</div>
</div>
<p>The degrees of freedom (<span class="math inline">\(n-1-k\)</span>) is also calculated by</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dof_residual</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>54.0</code></pre>
</div>
</div>
<p>The <code>ftest</code> can test more than two models. For example, suppose we test the null model with just an intercept, as in:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>resᵢ <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(Len <span class="op">~</span> <span class="fl">1</span>), ToothGrowth)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ftest</span>(resᵢ.model, res₀.model, res.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>F-test: 3 models fitted on 60 observations
──────────────────────────────────────────────────────────────────────
     DOF  ΔDOF        SSR        ΔSSR      R²     ΔR²       F*   p(&gt;F)
──────────────────────────────────────────────────────────────────────
[1]    2        3452.2093              0.0000                         
[2]    5     3   820.4250  -2631.7843  0.7623  0.7623  59.8795  &lt;1e-16
[3]    7     2   712.1060   -108.3190  0.7937  0.0314   4.1070  0.0219
──────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The output here has two <span class="math inline">\(p\)</span>-values, the first testing if the additive model is statistically significant (with a very small <span class="math inline">\(p\)</span>-value), the second testing, as mentioned, if the model with interaction is statistically significant compared to the additive model.</p>
</div>
<div id="exm-faraway" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.7</strong></span> We borrow an example from <span class="citation" data-cites="Faraway">(<a href="../references.html#ref-Faraway" role="doc-biblioref">Faraway 2004</a>)</span> to illustrate how the <span class="math inline">\(F\)</span>-test can be used to test a null hypothesis of <span class="math inline">\(H_0: \beta_i = \beta_j\)</span>.</p>
<p>The dataset is in the <code>datasets</code> package of R:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>savings <span class="op">=</span> <span class="fu">dataset</span>(<span class="st">"datasets"</span>, <span class="st">"LifeCycleSavings"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(savings, <span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div><div style="float: left;"><span>2×6 DataFrame</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">SR</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pop15</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Pop75</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DPI</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DDPI</th>
</tr>
<tr class="odd subheader headerLastRow">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String15">String15</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">Australia</td>
<td style="text-align: right;">11.43</td>
<td style="text-align: right;">29.35</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">2329.68</td>
<td style="text-align: right;">2.87</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">Austria</td>
<td style="text-align: right;">12.07</td>
<td style="text-align: right;">23.32</td>
<td style="text-align: right;">4.41</td>
<td style="text-align: right;">1507.99</td>
<td style="text-align: right;">3.93</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We fit the full model for <code>SR</code> through:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(SR <span class="op">~</span> Pop15 <span class="op">+</span> Pop75 <span class="op">+</span> DPI <span class="op">+</span> DDPI), savings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

SR ~ 1 + Pop15 + Pop75 + DPI + DDPI

Coefficients:
─────────────────────────────────────────────────────────────────────────────────
                    Coef.   Std. Error      t  Pr(&gt;|t|)    Lower 95%    Upper 95%
─────────────────────────────────────────────────────────────────────────────────
(Intercept)  28.5661       7.35452       3.88    0.0003  13.7533      43.3788
Pop15        -0.461193     0.144642     -3.19    0.0026  -0.752518    -0.169869
Pop75        -1.6915       1.0836       -1.56    0.1255  -3.87398      0.490983
DPI          -0.000336902  0.000931107  -0.36    0.7192  -0.00221225   0.00153844
DDPI          0.409695     0.196197      2.09    0.0425   0.0145336    0.804856
─────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>A test of <span class="math inline">\(H_0: \beta_1 = \beta_2\)</span> is done by preparing a variable <code>Pop15 + Pop75</code> (rather than a modification to the formula):</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>res1575 <span class="op">=</span> <span class="fu">lm</span>(<span class="pp">@formula</span>(SR <span class="op">~</span> Pop1575 <span class="op">+</span> DPI <span class="op">+</span> DDPI),</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">transform</span>(savings, [<span class="op">:</span>Pop15, <span class="op">:</span>Pop75] <span class="op">=&gt;</span> (<span class="op">+</span>) <span class="op">=&gt;</span> <span class="op">:</span>Pop1575))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>StatsModels.TableRegressionModel{LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

SR ~ 1 + Pop1575 + DPI + DDPI

Coefficients:
──────────────────────────────────────────────────────────────────────────────────
                    Coef.   Std. Error      t  Pr(&gt;|t|)    Lower 95%     Upper 95%
──────────────────────────────────────────────────────────────────────────────────
(Intercept)  21.6093       4.88336       4.43    &lt;1e-04  11.7796      31.439
Pop1575      -0.333633     0.103868     -3.21    0.0024  -0.542708    -0.124558
DPI          -0.000845101  0.000844351  -1.00    0.3221  -0.00254469   0.000854489
DDPI          0.390965     0.196871      1.99    0.0530  -0.00531671   0.787247
──────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The <code>ftest</code> then can be applied:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftest</span>(res.model, res1575.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>F-test: 2 models fitted on 50 observations
──────────────────────────────────────────────────────────────────
     DOF  ΔDOF       SSR     ΔSSR      R²      ΔR²      F*   p(&gt;F)
──────────────────────────────────────────────────────────────────
[1]    6        650.7130           0.3385                         
[2]    5    -1  673.6275  22.9145  0.3152  -0.0233  1.5847  0.2146
──────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p>The large <span class="math inline">\(p\)</span> value suggests no reason to reject this null.</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Faraway" class="csl-entry" role="listitem">
Faraway, J. J. (2004), <em>Linear models with r</em>, hapman &amp; Hall/CRC.
</div>
<div id="ref-WackerlyMendenhallSchaeffer" class="csl-entry" role="listitem">
Wackerly, D., Mendenhall, W., and Scheaffer, R. L. (2008), <em>Mathematical statistics with applications</em>, Cengage.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>A more general parameterization is to just use <span class="math inline">\(n-p\)</span> where <span class="math inline">\(p\)</span> is the <em>rank</em> of the model matrix. This parameterization covers models without an intercept.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Alternatively, the multivariate normal distribution can be used to write <span class="math inline">\(Y \sim Normal(X\beta, \sigma^2 I)\)</span>, where <span class="math inline">\(I\)</span> is the identity matrix. Matrices, as used here, compactly represent multiple equations and through matrix algebra allow symbolic rearrangements. Needed for this discussion are the notions of matrix addition, which requires similar shaped matrices; matrix multiplication, which requires a matching of the number of columns of one matrix with the number of rows of the other; matrix inverses, which require square-shaped matrices and allow the solving of <span class="math inline">\(Ax=b\)</span> formally with <span class="math inline">\(x=A^{-1}b\)</span>, though in practice more computationally efficient means are used; matrix transposes, which interchange rows for columns; and a vector norm, which is a generalization of the distance formula.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>In <code>Julia</code>, the <code>'</code> notation for a matrix denotes the adjoint of the matrix, which differs from the transpose for complex valued matrices.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This geometric interpretation of projection gives insight into the presence of an <span class="math inline">\(F\)</span> statistic later in this discussion. The <em>normal</em> equations are so named, as the imply the residual vector, <span class="math inline">\(Y - \hat{Y}\)</span> is perpendicular (also known as normal) to the columns, as vectors, of <span class="math inline">\(X\)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Inference/inference.html" class="pagination-link  aria-label=" &lt;span="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jverzani/UsingJ/edit/master/LinearModels/linear-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jverzani/UsingJ/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>© Copyright 2023, John Verzani. All rights reserved.</p>
</div>
  </div>
</footer>




</body></html>